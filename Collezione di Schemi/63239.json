{"$schema":"http:\/\/json-schema.org\/draft-06\/schema#","additionalProperties":false,"title":"Nextstrain metadata JSON schema proposal (meta + tree together)","type":"object","version":"2.0","properties":{"___tree":{"additionalProperties":false,"$comment":"The phylogeny in a nested JSON structure","type":"object","properties":{"___name":{"description":"Strain name. Must be unique. No spaces","type":"string"},"___branch_attrs":{"description":"attributes associated with the branch from the parent node to this node, such as branch lengths, mutations, support values","type":"object","properties":{"___labels":{"patternProperties":{"___^[a-zA-Z0-9]+$":{"$comment":"string is parsed unchanged by Auspice","type":"string"}},"description":"Node labels","$comment":"Auspice scans this to generate the branch labels dropdown"},"___mutations":{"patternProperties":{"___^[a-zA-Z0-9_-]+$":{"description":"Amino acid mutations for this gene (or annotated region)","$comment":"properties must exist in the meta.JSON -> annotation object","type":"array","items":{"pattern":"^[A-Z*-][0-9]+[A-Z*-]$"}}},"description":"Mutations occuring between the parent and this node","additionalProperties":false,"$comment":"combining nuc + AAs parallels the metadata -> annotations structure","type":"object","properties":{"___nuc":{"description":"nucelotide mutations","type":"array","items":{"oneOf":[{"pattern":"^[ATCGNYRWSKMDVHB-][0-9]+[ATCGNYRWSKMDVHB-]$","type":"string"},{"pattern":"^insertion [0-9]+-[0-9]+$","$comment":"TODO unused by auspice","type":"string"},{"pattern":"^deletion [0-9]+-[0-9]+$","$comment":"TODO unused by auspice","type":"string"}]}}}}}},"___children":{"minItems":2,"description":"Child nodes. Recursive structure. Terminal nodes do not have this property.","$comment":"Polytomies (more than 2 items) allowed.","type":"array","items":{"$eref":{"additionalProperties":false,"$comment":"The phylogeny in a nested JSON structure","type":"object","properties":{"___name":{"description":"Strain name. Must be unique. No spaces","type":"string"},"___branch_attrs":{"description":"attributes associated with the branch from the parent node to this node, such as branch lengths, mutations, support values","type":"object","properties":{"___labels":{"patternProperties":{"___^[a-zA-Z0-9]+$":{"$comment":"string is parsed unchanged by Auspice","type":"string"}},"description":"Node labels","$comment":"Auspice scans this to generate the branch labels dropdown"},"___mutations":{"patternProperties":{"___^[a-zA-Z0-9_-]+$":{"description":"Amino acid mutations for this gene (or annotated region)","$comment":"properties must exist in the meta.JSON -> annotation object","type":"array","items":{"pattern":"^[A-Z*-][0-9]+[A-Z*-]$"}}},"description":"Mutations occuring between the parent and this node","additionalProperties":false,"$comment":"combining nuc + AAs parallels the metadata -> annotations structure","type":"object","properties":{"___nuc":{"description":"nucelotide mutations","type":"array","items":{"oneOf":[{"pattern":"^[ATCGNYRWSKMDVHB-][0-9]+[ATCGNYRWSKMDVHB-]$","type":"string"},{"pattern":"^insertion [0-9]+-[0-9]+$","$comment":"TODO unused by auspice","type":"string"},{"pattern":"^deletion [0-9]+-[0-9]+$","$comment":"TODO unused by auspice","type":"string"}]}}}}}},"___children":{"minItems":2,"description":"Child nodes. Recursive structure. Terminal nodes do not have this property.","$comment":"Polytomies (more than 2 items) allowed.","type":"array","items":{"$ref":"#\/properties\/tree"}},"___node_attrs":{"patternProperties":{"___(?!div|num_date|vaccine|hidden|url|author|accession)(^.+$)":{"description":"coloring \/ geo resolution information attached to this node","$comment":"JSON schema defined properties must also validate agaisnt patternProperties if they match. Hence the complex regex.","type":"object","properties":{"___value":{"type":["string","number","boolean"]},"___entropy":{"$comment":"Auspice uses this to control opacity of the color-by","type":"number"},"___confidence":{"oneOf":[{"$comment":"Only used if the value is numeric","type":"array","items":[{"type":"number"},{"type":"number"}]},{"patternProperties":{"___^.+$":{"maximum":1,"type":"number","minimum":0}},"$comment":"alternative possibilities & their confidence values","type":"object"}],"description":"Confidence of the trait date","$comment":"Should we use different keys for the two structures here?"}},"required":["value"]}},"description":"attributes associated with the node (sequence, date, location) as opposed to changes from one node to another.","type":"object","properties":{"___div":{"description":"Node (phylogenetic) divergence","$comment":"Cumulative (root = 0)","type":"number"},"___url":{"pattern":"^https?:\/\/.+$","description":"URL of the sequence (usually https:\/\/www.ncbi.nlm.nih.gov\/nuccore\/...)","$comment":"terminal nodes only","type":"string"},"___vaccine":{"description":"Vaccine information","properties":{"___start_date":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"Vaccine usage start date","type":"string"},"___end_date":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"When the vaccine was stopped","$comment":"if vaccine still in use, don't include this property","type":"string"},"___serum":{"description":"strain used to raise sera (for ???)","$comment":"Currently in the flu & dengue trees","type":"boolean"},"___selection_date":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"Vaccine selection date","$comment":"this is currently in the metadata JSON","type":"string"}}},"___hidden":{"$comment":"Instruct auspice to hide the branches from this node to it's children","type":"string","enum":["always","timetree","divtree"]},"___author":{"description":"Author information (terminal nodes only)","type":"object","properties":{"___journal":{"description":"Journal title (including year, if applicable)","type":"string"},"___paper_url":{"pattern":"^https?:\/\/.+$","description":"URL link to paper (if available)","type":"string"},"___title":{"description":"Publication title","type":"string"},"___value":{"description":"unique value for this publication. Displayed as-is by auspice.","type":"string"}},"required":["value"]},"___num_date":{"$comment":"This is the only date information. We no longer have string dates.","type":"object","properties":{"___value":{"type":"number"},"___confidence":{"description":"Confidence of the node date","type":"array","items":[{"type":"number"},{"type":"number"}]}},"required":["value"]},"___accession":{"pattern":"^[0-9A-Za-z-_]+$","description":"Sequence accession number","$comment":"terminal nodes only","type":"string"}}}},"required":["name"]}}},"___node_attrs":{"patternProperties":{"___(?!div|num_date|vaccine|hidden|url|author|accession)(^.+$)":{"description":"coloring \/ geo resolution information attached to this node","$comment":"JSON schema defined properties must also validate agaisnt patternProperties if they match. Hence the complex regex.","type":"object","properties":{"___value":{"type":["string","number","boolean"]},"___entropy":{"$comment":"Auspice uses this to control opacity of the color-by","type":"number"},"___confidence":{"oneOf":[{"$comment":"Only used if the value is numeric","type":"array","items":[{"type":"number"},{"type":"number"}]},{"patternProperties":{"___^.+$":{"maximum":1,"type":"number","minimum":0}},"$comment":"alternative possibilities & their confidence values","type":"object"}],"description":"Confidence of the trait date","$comment":"Should we use different keys for the two structures here?"}},"required":["value"]}},"description":"attributes associated with the node (sequence, date, location) as opposed to changes from one node to another.","type":"object","properties":{"___div":{"description":"Node (phylogenetic) divergence","$comment":"Cumulative (root = 0)","type":"number"},"___url":{"pattern":"^https?:\/\/.+$","description":"URL of the sequence (usually https:\/\/www.ncbi.nlm.nih.gov\/nuccore\/...)","$comment":"terminal nodes only","type":"string"},"___vaccine":{"description":"Vaccine information","properties":{"___start_date":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"Vaccine usage start date","type":"string"},"___end_date":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"When the vaccine was stopped","$comment":"if vaccine still in use, don't include this property","type":"string"},"___serum":{"description":"strain used to raise sera (for ???)","$comment":"Currently in the flu & dengue trees","type":"boolean"},"___selection_date":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"Vaccine selection date","$comment":"this is currently in the metadata JSON","type":"string"}}},"___hidden":{"$comment":"Instruct auspice to hide the branches from this node to it's children","type":"string","enum":["always","timetree","divtree"]},"___author":{"description":"Author information (terminal nodes only)","type":"object","properties":{"___journal":{"description":"Journal title (including year, if applicable)","type":"string"},"___paper_url":{"pattern":"^https?:\/\/.+$","description":"URL link to paper (if available)","type":"string"},"___title":{"description":"Publication title","type":"string"},"___value":{"description":"unique value for this publication. Displayed as-is by auspice.","type":"string"}},"required":["value"]},"___num_date":{"$comment":"This is the only date information. We no longer have string dates.","type":"object","properties":{"___value":{"type":"number"},"___confidence":{"description":"Confidence of the node date","type":"array","items":[{"type":"number"},{"type":"number"}]}},"required":["value"]},"___accession":{"pattern":"^[0-9A-Za-z-_]+$","description":"Sequence accession number","$comment":"terminal nodes only","type":"string"}}}},"required":["name"]},"___version":{"pattern":"^v[0-9]+$","description":"JSON schema version","type":"string"},"___meta":{"additionalProperties":false,"$comment":"Metadata associated with phylogeny","type":"object","properties":{"___updated":{"pattern":"^[0-9X]{4}-[0-9X]{2}-[0-9X]{2}$","description":"Auspice displays this (currently only in the footer)","type":"string"},"___panels":{"minItems":1,"uniqueItems":true,"description":"Which panels should Auspice display?","$comment":"If additional JSONs are required (e.g. for frequencies), they will be fetched after parsing this array","type":"array","items":{"type":"string","enum":["tree","map","frequencies","entropy"]}},"___geo_resolutions":{"minItems":1,"description":"The available options for the geographic resolution dropdown, and their lat\/long information","type":"array","items":{"description":"Each object here is an indiviual geo resolution","additionalProperties":false,"type":"object","properties":{"___key":{"description":"Trait key - must be specified on nodes (e.g. 'country')","type":"string"},"___demes":{"patternProperties":{"___^[a-z_]+$":{"description":"Lat\/long info for this deme","additionalProperties":false,"$comment":"one day this may define a shape \/ polygon","type":"object","properties":{"___latitude":{"maximum":90,"type":"number","minimum":-90},"___longitude":{"maximum":180,"type":"number","minimum":-180}}}},"description":"The deme names & lat\/long info for this geographic resolution","$comment":"Each value defined across the tree needs to be present here, else Auspice cannot display the deme appropriately","type":"object"},"___title":{"description":"The title to display in the geo resolution dropdown. Optional -- if not provided then `key` will be used.","type":"string"}},"required":["key","demes"]}},"___maintainers":{"minItems":1,"uniqueItems":true,"description":"Who maintains this dataset?","$comment":"order similar to a publication","type":"array","items":{"type":"object","properties":{"___name":{"type":"string"},"___url":{"type":"string"}},"required":["name"]}},"___title":{"description":"Auspice displays this at the top of the page","type":"string"},"___build_url":{"description":"Auspice displays this at the top of the page as part of a byline","type":"string"},"___colorings":{"minItems":1,"description":"Available colorBys for Auspice","type":"array","items":{"description":"Each object here is an indiviual coloring, which will populate the sidebar dropdown in auspice","type":"object","properties":{"___key":{"description":"They key used to access the value of this coloring on each node","type":"string"},"___type":{"description":"Dictates how the color scale should be constructed","$comment":"The trait values (defined on tree nodes) must be numeric for continuous types, True \/ False for boolean, string or numeric for ordinal \/ categorical","type":"string","enum":["continuous","ordinal","categorical","boolean"]},"___scale":{"description":"Provided mapping between trait values & hex values","type":"array","items":{"type":"array","items":[{"description":"value of trait (should exist on >= 1 nodes)","type":"string"},{"pattern":"^#[0-9A-Fa-f]{6}$","description":"color hex value","type":"string"}]}},"___title":{"description":"Text to be displayed in the \"color by\" dropdown and the tree legend","$comment":"string is parsed unchanged by Auspice","type":"string"}},"required":["key","type"]}},"___description":{"description":"Auspice displays this currently in the footer.","$comment":"Generally a description of the phylogeny and\/or acknowledgements in Markdown format.","type":"string"},"___genome_annotations":{"patternProperties":{"___^[a-zA-Z0-9*_-]+$":{"$eref":{"type":"object","properties":{"___type":{"description":"Type of the feature. could be mRNA, CDS, or similar","$comment":"currently unused by Auspice","type":"string"},"___start":{"description":"Gene start position (one-based, following GFF format)","type":"number"},"___seqid":{"description":"Sequence on which the coordinates below are valid. Could be viral segment, bacterial contig, etc","$comment":"currently unused by Auspice","type":"string"},"___end":{"description":"Gene end position (one-based closed, last position of feature, following GFF format)","type":"number"},"___strand":{"description":"Positive or negative strand","type":"string","enum":["-","+"]}}}}},"description":"Genome annotations (e.g. genes), relative to the reference genome","additionalProperties":false,"$comment":"Required for the entropy panel","type":"object","properties":{"___nuc":{"type":"object","properties":{"___type":{"description":"Type of the feature. could be mRNA, CDS, or similar","$comment":"currently unused by Auspice","type":"string"},"___start":{"description":"Gene start position (one-based, following GFF format)","type":"number"},"___seqid":{"description":"Sequence on which the coordinates below are valid. Could be viral segment, bacterial contig, etc","$comment":"currently unused by Auspice","type":"string"},"___end":{"description":"Gene end position (one-based closed, last position of feature, following GFF format)","type":"number"},"___strand":{"description":"Positive or negative strand","type":"string","enum":["-","+"]}}}},"required":["nuc"]},"___filters":{"uniqueItems":true,"description":"These appear as filters in the footer of Auspice (which populates the displayed values based upon the tree)","$comment":"These values must be present as keys on a tree node -> trait","type":"array","items":{"type":"string"}},"___frequencies":{"$comment":"cc John \/ Trevor"},"___tree_name":{"description":"The name of the tree (e.g. segment name), if applicable","$comment":"e.g. `flu_h3n2_ha_3y` has a tree name of `ha`","type":"string"},"___display_defaults":{"description":"Set the defaults for certain display options in Auspice. All are optional.","additionalProperties":false,"$comment":"Anything able to be encoded in the auspice URL should be an option here, so this will expand over time","type":"object","properties":{"___geo_resolution":{"description":"Default geographic resolution","$comment":"The value here must be present in the geo object (see above)","type":"string"},"___layout":{"description":"Default tree layout","type":"string","enum":["rect","radial","unrooted","clock"]},"___map_triplicate":{"description":"Should the map be extended \/ wrapped around. Useful if transmissions are worldwide.","type":"boolean"},"___distance_measure":{"description":"Default tree metric","type":"string","enum":["div","num_date"]},"___color_by":{"description":"Default color by","$comment":"The value here must be present in the colorings object (see above)","type":"string"}}}},"required":["title","updated","panels"]}},"required":["version","meta","tree"]}