{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","description":"The requests that will be sent from the backend to the program","title":"Program Request","type":"object","definitions":{"_88programIntrospection":{"description":"A request for the program to alter its template according to the provided program rules","type":"object","title":"Program Introspection","properties":{"___rules":{"description":"The rules configured for this program","type":"object","title":"Program Rules (deprecated)"},"___program":{"additionalProperties":false,"type":"object","title":"Program","properties":{"___rules":{"description":"The rules configured for this program","type":"object","title":"Program Rules"},"___rewards":{"description":"Rewards associated with this program","type":"array","title":"Program Rewards","items":{"$eref":{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","description":"Establishes the available configuration for pre-defined.","title":"Pre-defined Rewards Schema","type":"object","definitions":{"_88reward":{"definitions":{"_88validityDuration":{"type":"string","title":"Duration Discount Is Valid"}}}},"properties":{"___reward":{"title":"Predefiend Reward","type":"object","properties":{"___rewardType":{"type":"string","enum":["PCT_DISCOUNT","CREDIT","FUELTANK","INTEGRATION"]},"___key":{"type":"string","title":"Reward Key"}},"required":["rewardType"],"dependencies":{"rewardType":{"oneOf":[{"properties":{"___rewardType":{"enum":["PCT_DISCOUNT"]},"___validityDuration":{"$ref":"#\/definitions\/reward\/definitions\/validityDuration"},"___amount":{"title":"Discount Percent","type":"integer"}},"required":["amount"]},{"properties":{"___rewardType":{"enum":["CREDIT"]},"___validityDuration":{"$ref":"#\/definitions\/reward\/definitions\/validityDuration"},"___amount":{"title":"Credit Amount","type":"integer"},"___unit":{"type":"string","title":"Unit"}},"required":["amount","unit"]},{"properties":{"___rewardType":{"enum":["FUELTANK"]},"___validityDuration":{"$ref":"#\/definitions\/reward\/definitions\/validityDuration"},"___fuelTankType":{"enumNames":["Discount","Credit"],"type":"string","title":"Reward Type","enum":["PCT_DISCOUNT","CREDIT"]}},"required":["fuelTankType"],"dependencies":{"fuelTankType":{"oneOf":[{"properties":{"___validityDuration":{"$ref":"#\/definitions\/reward\/definitions\/validityDuration"},"___fuelTankType":{"enum":["PCT_DISCOUNT"]},"___amount":{"title":"Discount Percent","type":"integer"}},"required":["amount"]},{"properties":{"___fuelTankType":{"enum":["CREDIT"]},"___amount":{"title":"Credit Amount","type":"integer"},"___unit":{"type":"string","title":"Unit"}},"required":["amount","unit"]}]}}},{"properties":{"___rewardType":{"enum":["INTEGRATION"]},"___integrationId":{"type":"string","title":"Integration Identifier"},"___amount":{"title":"Reward Amount","type":"integer"},"___integrationSettings":{"$ref":"RewardApiInput.schema.json#\/definitions\/integrationSettings"},"___unit":{"type":"string","title":"Gift Card Type"}},"required":["amount"]}]}}}}}}},"___id":{"description":"The unique program ID","type":"string","title":"Program ID"}}},"___template":{"$eref":{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","description":"Build your program using the magic of magic!","additionalProperties":false,"title":"Program Template Builder","type":"object","definitions":{"_88Requirement":{"description":"A condition that should be satified to confirm this program is working","title":"Program Requirement","type":"object","properties":{"___name":{"description":"The human-friendly name of this requirement","type":"string","title":"Name"},"___query":{"description":"The results of this query will be used to validate this requirement has been satisfied","type":["string","null"],"title":"GraphQL Query"},"___description":{"description":"A description of how this requirement can be satisfied","type":"string","title":"Description"},"___key":{"description":"A unique identifier used to validate this requirement","type":"string","title":"Key"},"___queryVariables":{"description":"These are passed in as parameters to the query","type":["object","null"],"title":"GraphQL Query Variables"},"___longDescription":{"description":"Rich content regarding the implementation and other details relevant to this requirement","type":"string","title":"Long Description"}},"required":["key","name","description"]},"_88WidgetType":{"description":"A type of widget that is displayed by this program.","title":"Widget Type","type":"object","properties":{"___name":{"description":"A human-readable name for the widget type that gets displayed in the SaaSquatch portal during program setup. e.g. `Referrer Widget`","type":"string","title":"Name"},"___description":{"default":"We send this widget when a new reward is created by this program","description":"A human-readable description that explains this widget type. Displayed in the SaaSquatch portal during program setup. e.g. `This widget is sent when a new reward is created by this program`","type":"string","title":"Description"},"___key":{"pattern":"[a-zA-Z0-9]+","description":"A unique key to identify this widget type. Only numbers and latin characers are allowed. Widget types must be unique within the scope of a program. e.g. `ReferrerWidget`","type":"string","title":"Key"},"___defaults":{"$ref":"HtmlWidget.schema.json"}}},"_88RewardType":{"description":"A type of reward that is given by this program.","title":"Reward Type","type":"object","properties":{"___name":{"default":"First Purchase Reward","description":"A human-readable name for the reward type that gets displayed in the SaaSquatch portal during program setup. e.g. `First Purchase Reward`","type":"string","title":"Name"},"___description":{"default":"This reward is given to people when they make their first purchase.","description":"A human-readable description that explains this reward type. Displayed in the SaaSquatch portal during program setup. e.g. `This reward is given to people when they make their first purchase.`","type":"string","title":"Description"},"___key":{"default":"firstPurchaseReward","pattern":"[a-zA-Z0-9]+","description":"A unique key to identify this reward type. Only numbers and latin characers are allowed. Reward types must be unique within the scope of a program. e.g. `FirstPurchaseReward`","title":"Key","type":"string"}}},"_88EmailType":{"description":"A type of email that is given by this program.","title":"Email Type","type":"object","properties":{"___name":{"default":"Reward Created Email","description":"A human-readable name for the email type that gets displayed in the SaaSquatch portal during program setup. e.g. `Reward Created Email`","type":"string","title":"Name"},"___description":{"default":"We send this email when a new reward is created by this program","description":"A human-readable description that explains this email type. Displayed in the SaaSquatch portal during program setup. e.g. `This email is sent when a new reward is created by this program`","type":"string","title":"Description"},"___key":{"default":"rewardCreatedEmail","pattern":"[a-zA-Z0-9]+","description":"A unique key to identify this email type. Only numbers and latin characers are allowed. Email types must be unique within the scope of a program. e.g. `RewardCreatedEmail`","title":"Key","type":"string"},"___defaults":{"oneOf":[{"type":"string","title":"Default Template Id"},{"$ref":"SimpleEmail.schema.json#"},{"$ref":"HtmlEmail.schema.json#"}]}}}},"properties":{"___rules":{"options":{"hidden":true},"description":"The business rule variables define a JSON schema of the possible configuration points in the business logic.","title":"Business Rule Variables","type":"object"},"___requirements":{"description":"All of these conditions should be satisfied to confirm the program is working","type":["array","null"],"title":"Program Requirements","items":{"$ref":"#\/definitions\/Requirement"}},"___rulesUISchema":{"description":"Defines how the rules will be shown via schema form","type":"object","title":"Rules UI Schema"},"___settings":{"type":"object","properties":{"___referrals":{"type":"object","properties":{"___enabled":{"description":"Whether this program supports referrals","type":"boolean"}}}}},"___installableByTenants":{"description":"The tenants that can install this program if it's not globally installable","type":["array","null"],"title":"Installable by Tenants","items":{"description":"The tenant alias for a tenant that can install this program","type":"string","title":"Tenant Alias"}},"___globallyInstallable":{"description":"Indicates whether this program can be installed by any tenant that support GA","type":"boolean","title":"Globally Installable"},"___widgets":{"description":"A list of all the possible types of widgets this program will send. Your business logic will trigger these based on key","type":"array","title":"Widgets","items":{"$ref":"#\/definitions\/EmailType"}},"___schedules":{"description":"The backend schedules that will run at a specified interval and trigger the program for specified users","type":["array","null"],"title":"Program Schedules","items":{"properties":{"___query":{"description":"The query used to create the program context when a user is evaluated by the schedule","type":"string","title":"Query"},"___key":{"description":"A unique identifier for this specific schedule","type":"string","title":"Schedule Key"},"___type":{"description":"The type of schedule to run","type":"string","title":"Schedule Type","enum":["USER","REWARD"]},"___filter":{"description":"The filter used to determine which users are evaluated when the schedule is run","type":"object","title":"Filter"},"___periodInHours":{"description":"The interval by which this schedule will run (e.g. every x hours)","type":"integer","title":"Period in Hours"}}}},"___userMetrics":{"description":"Custom metrics defined by this program that will only be activated when the program is live","type":"array","title":"Program User Metrics","items":{"$ref":"UserMetric.schema.json#"}},"___longDescription":{"options":{"expand_height":true},"description":"A long-form article that sells the benefits of this program. Dispayed in the SaaSquatch Portal during Program setup.","type":"string","title":"Program Long Description"},"___name":{"description":"A human-readable name for the program. Dispayed in the SaaSquatch Portal during Program setup.","type":"string","title":"Program Name"},"___trigger":{"description":"Defines specific triggers for this program","type":"object","title":"Program Triggers","properties":{"___eventKeys":{"description":"A list of events that can trigger this program","type":"array","title":"Event Keys","items":{"description":"When an event with this key is received this program will be triggered","type":"string","title":"Event Key"}}}},"___logo":{"description":"The URL for the logo associated with this program","type":"string","title":"Logo URL"},"___url":{"description":"The URL that will be requested for this program when triggered","type":"string","title":"Webtask URL"},"___rewards":{"description":"A list of all the possible types of rewards this program will give. Your business logic will trigger these based on key","type":"array","title":"Rewards","items":{"$ref":"#\/definitions\/RewardType","headerTemplate":"{{ self.name }}"}},"___rulesMigrationScript":{"description":"A JSONata script that transforms program rules JSON to be compatible with the most recently published schema version","type":"string","title":"Rules Migration Script"},"___installGuide":{"description":"This describes how to setup the current program and may update depending on how you've configured your program rules","type":"string","title":"Program Install Guide"},"___sharing":{"type":["object","null"],"title":"Sharing","properties":{"___linksConfig":{"description":"Message links configuration (default share text\/content for Open Graph\/Twitter\/etc)","type":"object","title":"Links Configuration","properties":{"___defaults":{"$ref":"ProgramMessages.schema.json#"}}},"___enabled":{"description":"When sharing is enabled the program will create\/support referral share links","type":"boolean","title":"Sharing Enabled"}}},"___summary":{"description":"A human-readable summary of the program. Dispayed in the SaaSquatch Portal during Program setup.","type":"string","title":"Program Summary"},"___emails":{"description":"A list of all the possible types of emails this program will send. Your business logic will trigger these based on key","type":"array","title":"Emails","items":{"$ref":"#\/definitions\/EmailType","headerTemplate":"{{ self.name }}"}},"___schedule":{"title":"Recurring schedule","type":["object","null"],"properties":{"___userFilter":{"description":"This should be a GraphQL-compatible query json object","type":"object","title":"User Filter"},"___periodInHours":{"description":"Your program logic will be run on this schedule.","type":"number"}}},"___id":{"description":"The unique contentful ID associated with this program template","type":"string","title":"ID"}}}},"___messageType":{"enum":["PROGRAM_INTROSPECTION"]}}},"_88programTrigger":{"description":"A request for the program to evaluate a user for against its criteria (determines whether to reward\/email\/etc. the user)","additionalProperties":true,"title":"Program Trigger","type":"object","properties":{"___messageType":{"enum":["PROGRAM_TRIGGER"]}}},"_88programValidation":{"description":"A request for the program to validate requirement query results","type":"object","title":"Program Validation","properties":{"___validationRequests":{"description":"The validations we're asking the program to perform for a given set of requirement keys and associated query results","type":"array","title":"Validation Requests","items":{"additionalProperties":false,"properties":{"___queryResult":{"description":"The requests from running the query associated with this requirement key","type":"object","title":"Query Result"},"___key":{"description":"The requirement key we're validating","type":"string","title":"Requirement Key"}}}},"___messageType":{"enum":["PROGRAM_VALIDATION"]}}},"_88programTriggerVariablesSchemaRequest":{"description":"A request for the programs trigger variables schema in case it is custom","title":"Program Trigger Variables Schema Request","type":"object","properties":{"___triggerType":{"type":"string","enum":["AFTER_USER_CREATED_OR_UPDATED","SCHEDULED","REWARD_SCHEDULED","REFERRAL","AFTER_USER_EVENT_PROCESSED"]},"___schema":{"description":"The default schema for the request, which will be overridden if necessary","type":"object","title":"Default Schema"},"___messageType":{"enum":["PROGRAM_TRIGGER_VARIABLES_SCHEMA_REQUEST"]}},"dependencies":{"triggerType":{"oneOf":[{"properties":{"___triggerType":{"enum":["SCHEDULED"]},"___scheduleKey":{"description":"Will match on the user schedule variables schema we're requesting","type":"string","title":"Schedule Key"}}},{"properties":{"___triggerType":{"type":"string","title":"Trigger Type","enum":["REWARD_SCHEDULED"]},"___scheduleKey":{"description":"Will match on the reward schedule variables schema we're requesting","type":"string","title":"Schedule Key"}}}]}}}},"properties":{"___version":{"description":"The RPC version for this program request","type":"string","title":"RPC Version"},"___messageType":{"description":"The type of request being made to the program","type":"string","title":"Message Type","enum":["PROGRAM_TRIGGER","PROGRAM_VALIDATION","PROGRAM_INTROSPECTION","PROGRAM_TRIGGER_VARIABLES_SCHEMA_REQUEST"]}},"dependencies":{"messageType":{"oneOf":[{"$eref":{"description":"A request for the program to evaluate a user for against its criteria (determines whether to reward\/email\/etc. the user)","additionalProperties":true,"title":"Program Trigger","type":"object","properties":{"___messageType":{"enum":["PROGRAM_TRIGGER"]}}}},{"$eref":{"description":"A request for the program to validate requirement query results","type":"object","title":"Program Validation","properties":{"___validationRequests":{"description":"The validations we're asking the program to perform for a given set of requirement keys and associated query results","type":"array","title":"Validation Requests","items":{"additionalProperties":false,"properties":{"___queryResult":{"description":"The requests from running the query associated with this requirement key","type":"object","title":"Query Result"},"___key":{"description":"The requirement key we're validating","type":"string","title":"Requirement Key"}}}},"___messageType":{"enum":["PROGRAM_VALIDATION"]}}}},{"$eref":{"description":"A request for the program to alter its template according to the provided program rules","type":"object","title":"Program Introspection","properties":{"___rules":{"description":"The rules configured for this program","type":"object","title":"Program Rules (deprecated)"},"___program":{"additionalProperties":false,"type":"object","title":"Program","properties":{"___rules":{"description":"The rules configured for this program","type":"object","title":"Program Rules"},"___rewards":{"description":"Rewards associated with this program","type":"array","title":"Program Rewards","items":{"$ref":"PredefinedReward.schema.json#"}},"___id":{"description":"The unique program ID","type":"string","title":"Program ID"}}},"___template":{"$ref":"ProgramTemplate.schema.json#"},"___messageType":{"enum":["PROGRAM_INTROSPECTION"]}}}},{"$eref":{"description":"A request for the programs trigger variables schema in case it is custom","title":"Program Trigger Variables Schema Request","type":"object","properties":{"___triggerType":{"type":"string","enum":["AFTER_USER_CREATED_OR_UPDATED","SCHEDULED","REWARD_SCHEDULED","REFERRAL","AFTER_USER_EVENT_PROCESSED"]},"___schema":{"description":"The default schema for the request, which will be overridden if necessary","type":"object","title":"Default Schema"},"___messageType":{"enum":["PROGRAM_TRIGGER_VARIABLES_SCHEMA_REQUEST"]}},"dependencies":{"triggerType":{"oneOf":[{"properties":{"___triggerType":{"enum":["SCHEDULED"]},"___scheduleKey":{"description":"Will match on the user schedule variables schema we're requesting","type":"string","title":"Schedule Key"}}},{"properties":{"___triggerType":{"type":"string","title":"Trigger Type","enum":["REWARD_SCHEDULED"]},"___scheduleKey":{"description":"Will match on the reward schedule variables schema we're requesting","type":"string","title":"Schedule Key"}}}]}}}}]}}}