{"patternProperties":{"___^\\.":{}},"$schema":"http:\/\/json-schema.org\/draft-07\/schema#","id":"https:\/\/batect.dev\/configSchema.json","additionalProperties":false,"title":"JSON schema for batect configuration files","type":"object","definitions":{"_88volumeMountList":{"type":"array","items":{"oneOf":[{"pattern":"^.+:.+(:.+)?$","type":"string"},{"additionalProperties":false,"type":"object","properties":{"___options":{"description":"Docker volume mount options to use when creating mount","type":"string","enum":["cached","delegated","consistent","default","ro"]},"___local":{"minLength":1,"description":"Path on the host machine to mount","type":"string"},"___container":{"minLength":1,"description":"Path inside the container to mount the host path at","type":"string"}},"required":["local","container"]}]}},"_88capabilityList":{"type":"array","items":{"oneOf":[{"type":"string","enum":["AUDIT_CONTROL","AUDIT_READ","AUDIT_WRITE","BLOCK_SUSPEND","CHOWN","DAC_OVERRIDE","DAC_READ_SEARCH","FOWNER","FSETID","IPC_LOCK","IPC_OWNER","KILL","LEASE","LINUX_IMMUTABLE","MAC_ADMIN","MAC_OVERRIDE","MKNOD","NET_ADMIN","NET_BIND_SERVICE","NET_BROADCAST","NET_RAW","SETGID","SETFCAP","SETPCAP","SETUID","SYS_ADMIN","SYS_BOOT","SYS_CHROOT","SYS_MODULE","SYS_NICE","SYS_PACCT","SYS_PTRACE","SYS_RAWIO","SYS_RESOURCE","SYS_TIME","SYS_TTY_CONFIG","SYSLOG","WAKE_ALARM","ALL"]}]}},"_88tasks":{"description":"Definitions for each of your tasks, the actions you launch through batect","additionalProperties":{"$eref":{"description":"Definition of a single task","additionalProperties":false,"type":"object","properties":{"___description":{"minLength":1,"description":"Description shown when running `batect --list-tasks`","type":"string"},"___prerequisites":{"uniqueItems":true,"description":"List of other tasks that should be run before running this task","type":"array","items":{"type":"string"}},"___dependencies":{"description":"List of other containers that should be started and healthy before starting the task container given in `run`","$ref":"#\/definitions\/containerDependencyList"},"___run":{"$ref":"#\/definitions\/taskRunOptions"},"___group":{"minLength":1,"description":"Name used to group tasks when running `batect --list-tasks`","type":"string"}},"required":["run"]}},"type":"object"},"_88configVariablesList":{"description":"Definitions for each of the config variables used to configure your tasks and containers","additionalProperties":{"$eref":{"description":"Definition of a single config variable","additionalProperties":false,"type":"object","properties":{"___description":{"minLength":1,"description":"Human-readable description of the purpose of the variable","type":"string"},"___default":{"minLength":1,"description":"Default value of the variable if one is not provided elsewhere","type":"string"}}}},"type":"object"},"_88buildArgList":{"additionalProperties":{"type":"string"},"type":"object"},"_88setupCommandsList":{"type":"array","items":{"additionalProperties":false,"type":"object","properties":{"___working_directory":{"minLength":1,"description":"Working directory to start the command in (defaults to container working directory if not set)","type":"string"},"___command":{"minLength":1,"description":"Command to execute","type":"string"}},"required":["command"]}},"_88container":{"oneOf":[{"not":{"required":["build_args","dockerfile"]},"required":["image"]},{"required":["build_directory"]}],"additionalProperties":false,"type":"object","properties":{"___working_directory":{"minLength":1,"description":"Working directory to start the container in","type":"string"},"___setup_commands":{"$eref":{"type":"array","items":{"additionalProperties":false,"type":"object","properties":{"___working_directory":{"minLength":1,"description":"Working directory to start the command in (defaults to container working directory if not set)","type":"string"},"___command":{"minLength":1,"description":"Command to execute","type":"string"}},"required":["command"]}},"description":"Commands to run after the container reports as healthy but before dependency containers start."},"___enable_init_process":{"description":"Set to `true` to run an init process inside the container that forwards signals and reaps processes","type":"boolean"},"___run_as_current_user":{"$eref":{"oneOf":[{"additionalProperties":false,"type":"object","properties":{"___enabled":{"description":"Set to `true` to enable 'run as current user' mode","type":"boolean","enum":[false]}},"required":["enabled"]},{"additionalProperties":false,"type":"object","properties":{"___home_directory":{"minLength":1,"description":"Directory to use as home directory for user inside container.","type":"string"},"___enabled":{"description":"Set to `true` to enable 'run as current user' mode","type":"boolean","enum":[true]}},"required":["enabled","home_directory"]}]}},"___health_check":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___interval":{"minLength":1,"description":"The interval between runs of the health check. Accepts values such as `2s` (two seconds) or `1m` (one minute).","type":"string"},"___command":{"minLength":1,"description":"The command to run to check the health of the container. If this command exits with code 0, the container is considered healthy.","type":"string"},"___retries":{"description":"The number of times to perform the health check before considering the container unhealthy","type":"integer","minimum":0},"___start_period":{"minLength":1,"description":"The time to wait before failing health checks count against the retry count. The health check is still run during this period, and if the check succeeds, the container is immediately considered healthy. Accepts values such as `2s` (two seconds) or `1m` (one minute).","type":"string"}}},"description":"Overrides health check configuration specified in the image or Dockerfile"},"___dependencies":{"$eref":{"uniqueItems":true,"type":"array","items":{"minLength":1,"type":"string"}},"description":"List of other containers that should be started and healthy before starting this container"},"___ports":{"$eref":{"type":"array","items":{"oneOf":[{"pattern":"^\\d+:\\d+$","type":"string"},{"additionalProperties":false,"type":"object","properties":{"___local":{"description":"Port on the host machine to map","type":"integer","minimum":1},"___container":{"description":"Port inside the container to map","type":"integer","minimum":1}},"required":["local","container"]}]}},"description":"List of ports to make available to the host machine"},"___image":{"minLength":1,"description":"Image name (in standard Docker image reference format) to use for this container","type":"string"},"___environment":{"$eref":{"additionalProperties":{"type":"string"},"type":"object"},"description":"List of environment variables for the container"},"___entrypoint":{"minLength":1,"description":"Entrypoint to use to run the command.","type":"string"},"___build_directory":{"minLength":1,"description":"Path (relative to the configuration file's directory) to a directory containing a Dockerfile to build and use as an image for this container","type":"string"},"___capabilities_to_drop":{"$eref":{"type":"array","items":{"oneOf":[{"type":"string","enum":["AUDIT_CONTROL","AUDIT_READ","AUDIT_WRITE","BLOCK_SUSPEND","CHOWN","DAC_OVERRIDE","DAC_READ_SEARCH","FOWNER","FSETID","IPC_LOCK","IPC_OWNER","KILL","LEASE","LINUX_IMMUTABLE","MAC_ADMIN","MAC_OVERRIDE","MKNOD","NET_ADMIN","NET_BIND_SERVICE","NET_BROADCAST","NET_RAW","SETGID","SETFCAP","SETPCAP","SETUID","SYS_ADMIN","SYS_BOOT","SYS_CHROOT","SYS_MODULE","SYS_NICE","SYS_PACCT","SYS_PTRACE","SYS_RAWIO","SYS_RESOURCE","SYS_TIME","SYS_TTY_CONFIG","SYSLOG","WAKE_ALARM","ALL"]}]}},"description":"List of additional capabilities to remove from the container"},"___command":{"minLength":1,"description":"Command to run when the container starts","type":"string"},"___capabilities_to_add":{"$eref":{"type":"array","items":{"oneOf":[{"type":"string","enum":["AUDIT_CONTROL","AUDIT_READ","AUDIT_WRITE","BLOCK_SUSPEND","CHOWN","DAC_OVERRIDE","DAC_READ_SEARCH","FOWNER","FSETID","IPC_LOCK","IPC_OWNER","KILL","LEASE","LINUX_IMMUTABLE","MAC_ADMIN","MAC_OVERRIDE","MKNOD","NET_ADMIN","NET_BIND_SERVICE","NET_BROADCAST","NET_RAW","SETGID","SETFCAP","SETPCAP","SETUID","SYS_ADMIN","SYS_BOOT","SYS_CHROOT","SYS_MODULE","SYS_NICE","SYS_PACCT","SYS_PTRACE","SYS_RAWIO","SYS_RESOURCE","SYS_TIME","SYS_TTY_CONFIG","SYSLOG","WAKE_ALARM","ALL"]}]}},"description":"List of additional capabilities to add to the container"},"___build_args":{"$eref":{"additionalProperties":{"type":"string"},"type":"object"},"description":"List of build args to use when building the image in build_directory"},"___volumes":{"$eref":{"type":"array","items":{"oneOf":[{"pattern":"^.+:.+(:.+)?$","type":"string"},{"additionalProperties":false,"type":"object","properties":{"___options":{"description":"Docker volume mount options to use when creating mount","type":"string","enum":["cached","delegated","consistent","default","ro"]},"___local":{"minLength":1,"description":"Path on the host machine to mount","type":"string"},"___container":{"minLength":1,"description":"Path inside the container to mount the host path at","type":"string"}},"required":["local","container"]}]}},"description":"List of volume mounts to create for the container"},"___dockerfile":{"minLength":1,"description":"Dockerfile (relative to build_directory) to use when building the image. Defaults to Dockerfile` if not set.","type":"string"},"___additional_hostnames":{"$eref":{"uniqueItems":true,"type":"array","items":{"minLength":1,"type":"string"}},"description":"Hostnames to associate with this container in addition to the default hostname."},"___privileged":{"description":"Enable privileged mode for the container","type":"boolean"}}},"_88containerDependencyList":{"uniqueItems":true,"type":"array","items":{"minLength":1,"type":"string"}},"_88healthCheckOptions":{"additionalProperties":false,"type":"object","properties":{"___interval":{"minLength":1,"description":"The interval between runs of the health check. Accepts values such as `2s` (two seconds) or `1m` (one minute).","type":"string"},"___command":{"minLength":1,"description":"The command to run to check the health of the container. If this command exits with code 0, the container is considered healthy.","type":"string"},"___retries":{"description":"The number of times to perform the health check before considering the container unhealthy","type":"integer","minimum":0},"___start_period":{"minLength":1,"description":"The time to wait before failing health checks count against the retry count. The health check is still run during this period, and if the check succeeds, the container is immediately considered healthy. Accepts values such as `2s` (two seconds) or `1m` (one minute).","type":"string"}}},"_88task":{"description":"Definition of a single task","additionalProperties":false,"type":"object","properties":{"___description":{"minLength":1,"description":"Description shown when running `batect --list-tasks`","type":"string"},"___prerequisites":{"uniqueItems":true,"description":"List of other tasks that should be run before running this task","type":"array","items":{"type":"string"}},"___dependencies":{"$eref":{"uniqueItems":true,"type":"array","items":{"minLength":1,"type":"string"}},"description":"List of other containers that should be started and healthy before starting the task container given in `run`"},"___run":{"$eref":{"description":"Specifies what to do when this task starts","additionalProperties":false,"type":"object","properties":{"___working_directory":{"minLength":1,"description":"Working directory to start the container in","type":"string"},"___command":{"minLength":1,"description":"Command to run for this task","type":"string"},"___ports":{"description":"List of port mappings to create for the container, in addition to those defined on the container itself","$ref":"#\/definitions\/portMappingList"},"___environment":{"description":"List of environment variables to pass to the container, in addition to those defined on the container itself","$ref":"#\/definitions\/environmentVariableList"},"___container":{"minLength":1,"description":"Container to run for this task","type":"string"},"___entrypoint":{"minLength":1,"description":"Entrypoint to use to run the command for this task.","type":"string"}},"required":["container"]}},"___group":{"minLength":1,"description":"Name used to group tasks when running `batect --list-tasks`","type":"string"}},"required":["run"]},"_88runAsCurrentUserOptions":{"oneOf":[{"additionalProperties":false,"type":"object","properties":{"___enabled":{"description":"Set to `true` to enable 'run as current user' mode","type":"boolean","enum":[false]}},"required":["enabled"]},{"additionalProperties":false,"type":"object","properties":{"___home_directory":{"minLength":1,"description":"Directory to use as home directory for user inside container.","type":"string"},"___enabled":{"description":"Set to `true` to enable 'run as current user' mode","type":"boolean","enum":[true]}},"required":["enabled","home_directory"]}]},"_88taskRunOptions":{"description":"Specifies what to do when this task starts","additionalProperties":false,"type":"object","properties":{"___working_directory":{"minLength":1,"description":"Working directory to start the container in","type":"string"},"___command":{"minLength":1,"description":"Command to run for this task","type":"string"},"___ports":{"$eref":{"type":"array","items":{"oneOf":[{"pattern":"^\\d+:\\d+$","type":"string"},{"additionalProperties":false,"type":"object","properties":{"___local":{"description":"Port on the host machine to map","type":"integer","minimum":1},"___container":{"description":"Port inside the container to map","type":"integer","minimum":1}},"required":["local","container"]}]}},"description":"List of port mappings to create for the container, in addition to those defined on the container itself"},"___environment":{"$eref":{"additionalProperties":{"type":"string"},"type":"object"},"description":"List of environment variables to pass to the container, in addition to those defined on the container itself"},"___container":{"minLength":1,"description":"Container to run for this task","type":"string"},"___entrypoint":{"minLength":1,"description":"Entrypoint to use to run the command for this task.","type":"string"}},"required":["container"]},"_88environmentVariableList":{"additionalProperties":{"type":"string"},"type":"object"},"_88portMappingList":{"type":"array","items":{"oneOf":[{"pattern":"^\\d+:\\d+$","type":"string"},{"additionalProperties":false,"type":"object","properties":{"___local":{"description":"Port on the host machine to map","type":"integer","minimum":1},"___container":{"description":"Port inside the container to map","type":"integer","minimum":1}},"required":["local","container"]}]}},"_88additionalHostnamesList":{"uniqueItems":true,"type":"array","items":{"minLength":1,"type":"string"}},"_88containers":{"description":"Definitions for each of the containers that make up your various environments","additionalProperties":{"$eref":{"oneOf":[{"not":{"required":["build_args","dockerfile"]},"required":["image"]},{"required":["build_directory"]}],"additionalProperties":false,"type":"object","properties":{"___working_directory":{"minLength":1,"description":"Working directory to start the container in","type":"string"},"___setup_commands":{"description":"Commands to run after the container reports as healthy but before dependency containers start.","$ref":"#\/definitions\/setupCommandsList"},"___enable_init_process":{"description":"Set to `true` to run an init process inside the container that forwards signals and reaps processes","type":"boolean"},"___run_as_current_user":{"$ref":"#\/definitions\/runAsCurrentUserOptions"},"___health_check":{"description":"Overrides health check configuration specified in the image or Dockerfile","$ref":"#\/definitions\/healthCheckOptions"},"___dependencies":{"description":"List of other containers that should be started and healthy before starting this container","$ref":"#\/definitions\/containerDependencyList"},"___ports":{"description":"List of ports to make available to the host machine","$ref":"#\/definitions\/portMappingList"},"___image":{"minLength":1,"description":"Image name (in standard Docker image reference format) to use for this container","type":"string"},"___environment":{"description":"List of environment variables for the container","$ref":"#\/definitions\/environmentVariableList"},"___entrypoint":{"minLength":1,"description":"Entrypoint to use to run the command.","type":"string"},"___build_directory":{"minLength":1,"description":"Path (relative to the configuration file's directory) to a directory containing a Dockerfile to build and use as an image for this container","type":"string"},"___capabilities_to_drop":{"description":"List of additional capabilities to remove from the container","$ref":"#\/definitions\/capabilityList"},"___command":{"minLength":1,"description":"Command to run when the container starts","type":"string"},"___capabilities_to_add":{"description":"List of additional capabilities to add to the container","$ref":"#\/definitions\/capabilityList"},"___build_args":{"description":"List of build args to use when building the image in build_directory","$ref":"#\/definitions\/buildArgList"},"___volumes":{"description":"List of volume mounts to create for the container","$ref":"#\/definitions\/volumeMountList"},"___dockerfile":{"minLength":1,"description":"Dockerfile (relative to build_directory) to use when building the image. Defaults to Dockerfile` if not set.","type":"string"},"___additional_hostnames":{"description":"Hostnames to associate with this container in addition to the default hostname.","$ref":"#\/definitions\/additionalHostnamesList"},"___privileged":{"description":"Enable privileged mode for the container","type":"boolean"}}}},"type":"object"},"_88configVariable":{"description":"Definition of a single config variable","additionalProperties":false,"type":"object","properties":{"___description":{"minLength":1,"description":"Human-readable description of the purpose of the variable","type":"string"},"___default":{"minLength":1,"description":"Default value of the variable if one is not provided elsewhere","type":"string"}}}},"properties":{"___containers":{"$eref":{"description":"Definitions for each of the containers that make up your various environments","additionalProperties":{"$ref":"#\/definitions\/container"},"type":"object"}},"___tasks":{"$eref":{"description":"Definitions for each of your tasks, the actions you launch through batect","additionalProperties":{"$ref":"#\/definitions\/task"},"type":"object"}},"___config_variables":{"$eref":{"description":"Definitions for each of the config variables used to configure your tasks and containers","additionalProperties":{"$ref":"#\/definitions\/configVariable"},"type":"object"}},"___project_name":{"minLength":1,"description":"The name of your project. Used to label any images built.","type":"string"}},"required":["containers","tasks"]}