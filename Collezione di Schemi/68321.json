{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","title":"atomic-reactor server-side configuration","type":["object","null"],"definitions":{"_88media_types":{"description":"Media types to be found in registry","type":"array","items":{"type":"string","enum":["application\/json","application\/vnd.docker.distribution.manifest.v1+json","application\/vnd.docker.distribution.manifest.v2+json","application\/vnd.docker.distribution.manifest.list.v2+json","application\/vnd.oci.image.manifest.v1+json","application\/vnd.oci.image.index.v1+json"]}},"_88enable":{"description":"Enable authentication","type":"boolean"},"_88organization":{"description":"Registry organization","type":"string"},"_88proxyuser":{"description":"Login as different user","type":"string"}},"properties":{"___group_manifests":{"description":"Create manifest list, or image index, in container registry","type":"boolean"},"___prefer_schema1_digest":{"description":"schema 1 as preferred digest","type":"boolean"},"___sources_command":{"description":"Command to retrieve artifacts in lookaside cache","type":"string"},"___package_comparison_exceptions":{"description":"List of packages that are not compared across architectures","type":"array","items":{"type":"string"}},"___buildstep_alias":{"patternProperties":{"___^[\\w_]+$":{"type":"string","enum":["docker_api","imagebuilder"]}},"description":"Aliases for buildstep plugins","additionalProperties":false,"type":"object"},"___cachito":{"description":"Cachito instance","additionalProperties":false,"type":"object","properties":{"___insecure":{"description":"Don't check SSL certificate for api_url","type":"boolean"},"___auth":{"description":"Authentication information","additionalProperties":false,"type":"object","properties":{"___ssl_certs_dir":{"description":"Path to directory with cert file","type":"string"}}},"___unknown_user":{"default":"unknown_user","description":"User to set in cachito request user param in case koji user is not found","type":"string"},"___api_url":{"description":"Cachito API url","type":"string"}},"required":["api_url","auth"]},"___deep_manifest_list_inspection":{"default":true,"description":"If manifest list digest check fails, inspect the manifest list contents","type":"boolean"},"___arrangement_version":{"description":"Arrangement version","type":"integer"},"___openshift":{"description":"OpenShift instance running build","additionalProperties":false,"type":"object","properties":{"___insecure":{"description":"Don't check SSL certificate for url","type":"boolean"},"___auth":{"description":"Authentication information","anyOf":[{"additionalProperties":false,"properties":{"___krb_keytab_path":{"description":"Location of Kerberos keytab, e.g. FILE:<absolute_path>","type":"string"},"___krb_cache_path":{"description":"Path to kerberos credential cache file","type":"string"},"___enable":{"$eref":{"description":"Enable authentication","type":"boolean"}},"___krb_principal":{"description":"Kerberos principal","type":"string"}},"required":["krb_principal","krb_keytab_path"]},{"additionalProperties":false,"properties":{"___ssl_certs_dir":{"description":"Path to directory with cert, key and ca files","type":"string"},"___enable":{"$eref":{"description":"Enable authentication","type":"boolean"}}},"required":["ssl_certs_dir"]},{"additionalProperties":false,"properties":{"___enable":{"$eref":{"description":"Enable authentication","type":"boolean"}}}}],"type":"object"},"___url":{"description":"OpenShift url","type":"string"},"___build_json_dir":{"description":"Path to directory containing Json files templates for osbs-client lib","type":"string"}},"required":["url"]},"___clusters":{"patternProperties":{"___^[a-zA-Z0-9_]*$":{"description":"List of clusters for this platform","type":"array","items":{"additionalProperties":false,"properties":{"___name":{"description":"osbs-client instance name for this cluster","type":"string"},"___enabled":{"default":true,"description":"Whether this cluster should be used","type":"boolean"},"___max_concurrent_builds":{"description":"Maximum number of active builds","type":"integer","minimum":0}},"required":["name","max_concurrent_builds"]}}},"description":"Clusters grouped by platform name","additionalProperties":false,"type":"object"},"___version":{"type":"integer"},"___default_image_build_method":{"description":"Specify different default buildstep plugin for worker builds","enum":["docker_api","imagebuilder","buildah_bud"]},"___omps":{"description":"Integration with OMPS service for pushing operators manifests to appregistry","additionalProperties":false,"type":["object","null"],"properties":{"___omps_secret_dir":{"description":"Path to dir with secrets","type":"string"},"___insecure":{"description":"Connect to OMPS service insecurely (default: false)","type":"boolean"},"___appregistry_url":{"description":"URL for appregistry where operator manifests are stored","type":"string"},"___omps_namespace":{"description":"Namespace (organization) where manifest will be pushed","type":"string"},"___koji_insecure":{"description":"Download data from koji insecurely (default: false)","type":"boolean"},"___omps_url":{"description":"URL of OMPS REST API","type":"string"}},"required":["omps_url","omps_namespace","omps_secret_dir","appregistry_url"]},"___koji":{"description":"Koji instance","additionalProperties":false,"type":"object","properties":{"___hub_url":{"description":"Koji hub's xmlrpc url","type":"string"},"___auth":{"description":"Authentication information","anyOf":[{"additionalProperties":false,"properties":{"___proxyuser":{"$eref":{"description":"Login as different user","type":"string"}},"___ssl_certs_dir":{"description":"Path to directory with cert and ca files","type":"string"}},"required":["ssl_certs_dir"]},{"additionalProperties":false,"properties":{"___proxyuser":{"$eref":{"description":"Login as different user","type":"string"}},"___krb_keytab_path":{"description":"Location of Kerberos keytab, e.g. FILE:<absolute_path>","type":"string"},"___krb_cache_path":{"description":"Path to kerberos credential cache file","type":"string"},"___krb_principal":{"description":"Kerberos principal","type":"string"}},"required":["krb_principal","krb_keytab_path"]},{"additionalProperties":false,"properties":{"___proxyuser":{"$eref":{"description":"Login as different user","type":"string"}}}}],"type":"object"},"___root_url":{"description":"Koji's root storage url","type":"string"},"___task_annotations_whitelist":{"description":"Annotations to be included in the build_annotations.json task output file. If empty or not described, the file will not be generated","type":"array","items":{"type":"string"}},"___delegate_task":{"default":true,"description":"Autorebuild will create new intermediate task, instead of using original task","type":"boolean"},"___reserve_build":{"default":false,"description":"Reserve build id and NVR through Content Generator API. If set, requires koji > 1.17.0","type":"boolean"},"___delegated_task_priority":{"description":"When delegate_build is enabled, delegated task will use this koji task priority, if not set it will use default koji priority","type":"integer"},"___use_fast_upload":{"default":true,"description":"Use Koji's fast upload API","type":"boolean"},"___insecure_download":{"default":false,"description":"Download data from koji insecurely","type":"boolean"}},"required":["hub_url","root_url","auth"]},"___registries":{"description":"Container registries to output images","type":"array","items":{"additionalProperties":false,"type":"object","properties":{"___insecure":{"description":"Don't check SSL certificate for url","type":"boolean"},"___auth":{"description":"Authentication information","additionalProperties":false,"type":"object","properties":{"___cfg_path":{"description":"Path to directory  containing .dockercfg for registry auth","type":"string"}},"required":["cfg_path"]},"___url":{"description":"Registry URI including version","type":"string"},"___expected_media_types":{"$eref":{"description":"Media types to be found in registry","type":"array","items":{"type":"string","enum":["application\/json","application\/vnd.docker.distribution.manifest.v1+json","application\/vnd.docker.distribution.manifest.v2+json","application\/vnd.docker.distribution.manifest.list.v2+json","application\/vnd.oci.image.manifest.v1+json","application\/vnd.oci.image.index.v1+json"]}}}},"required":["url"]}},"___clusters_client_config_dir":{"description":"Path to directory with osbs.conf for communicating with workers","type":"string"},"___image_equal_labels":{"description":"Labels that are expected to be equal in value","type":"array","items":{"type":"array","items":{"type":"string"}}},"___fail_on_digest_mismatch":{"default":true,"description":"Raise an error and stop build when a manifest list digest check fails","type":"boolean"},"___registries_organization":{"$eref":{"description":"Registry organization","type":"string"}},"___image_labels":{"patternProperties":{"___^[\\w\\.-]+$":{"type":"string"}},"description":"Labels to be applied to container image","additionalProperties":false,"type":"object"},"___smtp":{"description":"SMTP notifications","additionalProperties":false,"type":"object","properties":{"___from_address":{"description":"From email address in notification email","type":"string"},"___error_addresses":{"description":"Email addresses to send notifications if no other email address can be resolved","type":"array","items":{"type":"string"}},"___additional_addresses":{"description":"Email addresses to always send notification email","type":"array","items":{"type":"string"}},"___domain":{"description":"Domain used when constructing email addresses","type":"string"},"___send_to_pkg_owner":{"description":"Send email notification to Koji package owner","type":"boolean"},"___host":{"description":"SMTP host server name","type":"string"},"___send_to_submitter":{"description":"Send email notification to Koji task submitter","type":"boolean"}},"required":["host","from_address"]},"___flatpak":{"description":"Flatpak specific properties","additionalProperties":false,"type":"object","properties":{"___base_image":{"description":"host image used to install packages when creating a Flatpak","type":"string"},"___metadata":{"description":"how to store Flatpak metadata in the image","type":"string","enum":["annotations","labels","both"]}}},"___source_container":{"description":"Properties relating to source containers","additionalProperties":false,"type":"object","properties":{"___limit_media_types":{"allOf":[{"$eref":{"description":"Media types to be found in registry","type":"array","items":{"type":"string","enum":["application\/json","application\/vnd.docker.distribution.manifest.v1+json","application\/vnd.docker.distribution.manifest.v2+json","application\/vnd.docker.distribution.manifest.list.v2+json","application\/vnd.oci.image.manifest.v1+json","application\/vnd.oci.image.index.v1+json"]}}}],"description":"Do not report any media types other than these"}}},"___build_image_override":{"description":"Specify different build_image image for platforms","additionalProperties":{"type":"string"},"type":"object"},"___yum_proxy":{"description":"Proxy to access yum repositories","type":"string"},"___source_registry":{"description":"Container registry to pull parent images","additionalProperties":false,"type":"object","properties":{"___insecure":{"description":"Don't check SSL certificate for url","type":"boolean"},"___auth":{"description":"Authentication information","additionalProperties":false,"type":"object","properties":{"___cfg_path":{"description":"Path to directory  containing .dockercfg for registry auth","type":"string"}},"required":["cfg_path"]},"___url":{"description":"Registry url","type":"string"}},"required":["url"]},"___worker_token_secrets":{"description":"List of OpenShift secrets for worker clusters authentication","type":"array","items":{"type":"string"}},"___pulp":{"description":"Pulp registry instance (deprecated)","additionalProperties":false,"type":"object","properties":{"___name":{"description":"Pulp registry name, specified in \/etc\/dockpulp.conf","type":"string"},"___auth":{"description":"Authentication information","anyOf":[{"additionalProperties":false,"properties":{"___ssl_certs_dir":{"description":"Path to directory with pulp.cer and pulp.key files","type":"string"}},"required":["ssl_certs_dir"]},{"additionalProperties":false,"properties":{"___password":{"description":"Pulp password","type":"string"},"___username":{"description":"Pulp username","type":"string"}},"required":["username","password"]}],"type":"object"},"___loglevel":{"description":"Log level","type":"string"}},"required":["name","auth"]},"___content_versions":{"description":"Produce container image of given version","type":"array","items":{"type":"string","enum":["v2"]}},"___artifacts_allowed_domains":{"description":"Domains allowed to use when fetching artifacts by url, if not specified no restrictions will be applied","type":"array","items":{"type":"string"}},"___image_label_info_url_format":{"description":"URL format (with {label}-style substitution) for 'info' label","type":"string"},"___skip_koji_check_for_base_image":{"description":"Allow base image without related koji build (insecure)","type":"boolean"},"___required_secrets":{"description":"List of OpenShift secrets required by this configuration","type":"array","items":{"type":"string"}},"___yum_repo_allowed_domains":{"description":"Domains allowed when fetching yum repo files. If not specified, no restrictions will be applied. The restriction does not apply to scratch builds","type":"array","items":{"type":"string"}},"___platform_descriptors":{"description":"Definition of supported platforms","type":"array","items":{"additionalProperties":false,"type":"object","properties":{"___platform":{"type":"string"},"___architecture":{"type":"string"}}}},"___hide_files":{"description":"Hide files during build for each stage","additionalProperties":false,"type":"object","properties":{"___files":{"minItems":1,"uniqueItems":true,"description":"List of files to hide","type":"array","items":{"minLength":1,"type":"string"}},"___tmpdir":{"minLength":1,"description":"Temporary location, where files will be hidden","type":"string"}},"required":["tmpdir","files"]},"___odcs":{"description":"OnDemand Compose Service (ODCS) instance","additionalProperties":false,"type":"object","properties":{"___default_signing_intent":{"description":"Default signing intent","type":"string"},"___signing_intents":{"description":"List of signing intents","type":"array","items":{"additionalProperties":false,"properties":{"___name":{"description":"signing intent name","type":"string"},"___keys":{"description":"signing intent keys","type":"array","items":{"type":"string"}}},"required":["name","keys"]}},"___auth":{"description":"Authentication information","anyOf":[{"additionalProperties":false,"properties":{"___ssl_certs_dir":{"description":"Path to directory with cert file","type":"string"}},"required":["ssl_certs_dir"]},{"additionalProperties":false,"properties":{"___openidc_dir":{"description":"Path to directory with token file","type":"string"}},"required":["openidc_dir"]}],"type":"object"},"___insecure":{"description":"Don't check SSL certificate for api_url","type":"boolean"},"___api_url":{"description":"ODCS api url, including api version","type":"string"}},"required":["api_url","auth","signing_intents","default_signing_intent"]}},"required":["version"]}