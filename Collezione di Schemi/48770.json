{"outputs":{"WebHookURI":{"type":"string","value":"[listCallbackURL(concat(resourceId('Microsoft.Logic\/workflows\/', parameters('logicAppName')), '\/triggers\/manual'), '2016-06-01').value]"}},"variables":{},"$schema":"https:\/\/schema.management.azure.com\/schemas\/2015-01-01\/deploymentTemplate.json#","resources":[{"apiVersion":"2015-08-01","name":"[parameters('svcPlanName')]","location":"[resourceGroup().location]","sku":{"tier":"[parameters('sku')]","name":"[parameters('svcPlanSize')]","capacity":1},"type":"Microsoft.Web\/serverfarms"},{"apiVersion":"2016-06-01","name":"[parameters('slackConnectionName')]","location":"[resourceGroup().location]","type":"Microsoft.Web\/connections","properties":{"___api":{"id":"[concat(subscription().id,'\/providers\/Microsoft.Web\/locations\/', resourceGroup().location, '\/managedApis\/slack')]"},"___displayName":"slack","___parameterValues":{}}},{"apiVersion":"2015-02-01-preview","dependsOn":["[resourceId('Microsoft.Web\/connections', parameters('slackConnectionName'))]","[resourceId('Microsoft.Web\/serverfarms', parameters('svcPlanName'))]"],"name":"[parameters('logicAppName')]","location":"[resourceGroup().location]","type":"Microsoft.Logic\/workflows","properties":{"___definition":{"outputs":{},"$schema":"https:\/\/schema.management.azure.com\/providers\/Microsoft.Logic\/schemas\/2016-06-01\/workflowdefinition.json#","triggers":{"manual":{"kind":"Http","inputs":{"schema":{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","type":"object","properties":{"___status":{"type":"string"},"___context":{"type":"object","properties":{"___name":{"type":"string"},"___resourceName":{"type":"string"},"___portalLink":{"type":"string"}},"required":["name","portalLink","resourceName"]}},"required":["status","context"]}},"type":"request"}},"contentVersion":"1.0.0.0","actions":{"Post_Message":{"inputs":{"path":"\/chat.postMessage","method":"post","host":{"connection":{"name":"@parameters('$connections')['slack']['connectionId']"}},"queries":{"channel":"[parameters('slackChannel')]","text":"Azure Alert - '@{triggerBody()['context']['name']}' @{triggerBody()['status']} on '@{triggerBody()['context']['resourceName']}'.  Details: @{body('Http')['id']}"}},"runAfter":{"Http":["Succeeded"]},"type":"ApiConnection"},"Http":{"inputs":{"headers":{"Content-Type":"application\/json"},"method":"POST","body":{"longUrl":"@{triggerBody()['context']['portalLink']}"},"uri":"https:\/\/www.googleapis.com\/urlshortener\/v1\/url?key=AIzaSyBkT1BRbA-uULHz8HMUAi0ywJtpNLXHShI"},"runAfter":{},"type":"Http"}},"parameters":{"$connections":{"defaultValue":{},"type":"Object"}}},"___parameters":{"$connections":{"value":{"slack":{"connectionId":"[resourceId('Microsoft.Web\/connections', parameters('slackConnectionName'))]","id":"[concat(subscription().id,'\/providers\/Microsoft.Web\/locations\/', resourceGroup().location, '\/managedApis\/slack')]"}}}},"___sku":{"name":"[parameters('sku')]","plan":{"id":"[concat(resourceGroup().id, '\/providers\/Microsoft.Web\/serverfarms\/',parameters('svcPlanName'))]"}}}}],"contentVersion":"1.0.0.0","parameters":{"svcPlanName":{"metadata":{"description":"The name of the App Service plan to create for hosting the logic app."},"defaultValue":"SlackLogicAppsPlan","type":"string"},"slackConnectionName":{"metadata":{"description":"The name for the Slack connection."},"defaultValue":"SlackConnection","type":"string"},"slackChannel":{"metadata":{"description":"The Slack channel to post to."},"defaultValue":"#general","type":"string"},"sku":{"allowedValues":["Free","Basic","Standard","Premium"],"metadata":{"description":"The pricing tier for the App Service plan."},"defaultValue":"Standard","type":"string"},"svcPlanSize":{"metadata":{"description":"The instance size of the app."},"defaultValue":"S1","type":"string"},"logicAppName":{"metadata":{"description":"The name for the logic app."},"type":"string"}}}