{"$schema":"http:\/\/json-schema.org\/draft-04\/hyper-schema#","links":[],"id":"#app-version-v1","additionalProperties":false,"title":"Schema for deployment","type":"object","definitions":{"_88environment":{"patternProperties":{"___.*":{"oneOf":[{"type":"string","maxLength":4096},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___value":{"type":"string","maxLength":8192},"___encrypted":{"type":"boolean"}},"required":["value"]}}]}},"additionalProperties":false},"_88notification-hipchat":{"additionalProperties":false,"properties":{"___url":{"description":"Hipchat v2 api url","type":"string"},"___room":{"description":"Room to be used for notification","type":"string"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"description":"Min level for the message to activate this notifier","type":"number"},"___token":{"oneOf":[{"type":"string"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___value":{"type":"string","maxLength":8192},"___encrypted":{"type":"boolean"}},"required":["value"]}}],"description":"Hipchat API v2 token (personal\/ room) for notification"},"___colors":{"description":"Color mapping","type":"object"}}},"_88encrypted-type":{"additionalProperties":false,"type":"object","properties":{"___value":{"type":"string","maxLength":8192},"___encrypted":{"type":"boolean"}},"required":["value"]},"_88notification-github":{"additionalProperties":false,"properties":{"___url":{"description":"Github API url base","type":"string"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___token":{"oneOf":[{"type":"string"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___value":{"type":"string","maxLength":8192},"___encrypted":{"type":"boolean"}},"required":["value"]}}],"description":"Github Oauth token"},"___level":{"description":"Min level for the message to activate this notifier","type":"number"}}},"_88host":{"description":"Proxy Host definition","additionalProperties":false,"type":"object","properties":{"___hostname":{"pattern":"^[a-zA-Z0-9\\-.\\s,]*[a-zA-Z0-9\\s\\-,]$","description":"Hostname(s) to be registered with proxy. If multiple hosts need to be specified, separate them using comma or space","type":"string"},"___enabled":{"description":"Is host enabled?","type":"boolean"},"___locations":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy location definition for a given proxy path","additionalProperties":false,"type":"object","properties":{"___denied-acls":{"description":"List of Denied proxy ACLs","type":"array","items":{"type":"string"}},"___force-ssl":{"default":false,"description":"If SSL needs to be forced at the given path","type":"boolean"},"___allowed-acls":{"description":"List of Allowed proxy ACLs","type":"array","items":{"type":"string"}},"___enabled":{"description":"Is location enabled?","type":"boolean"},"___port":{"description":"Internal container port for proxy.","type":"number","minimum":1},"___path":{"description":"Path to be used for proxy","type":"string"}}}}},"description":"Locations for given proxy host.","type":"object"}}},"_88location":{"description":"Proxy location definition for a given proxy path","additionalProperties":false,"type":"object","properties":{"___denied-acls":{"description":"List of Denied proxy ACLs","type":"array","items":{"type":"string"}},"___force-ssl":{"default":false,"description":"If SSL needs to be forced at the given path","type":"boolean"},"___allowed-acls":{"description":"List of Allowed proxy ACLs","type":"array","items":{"type":"string"}},"___enabled":{"description":"Is location enabled?","type":"boolean"},"___port":{"description":"Internal container port for proxy.","type":"number","minimum":1},"___path":{"description":"Path to be used for proxy","type":"string"}}},"_88health":{"description":"Health check definition for proxy upstream","additionalProperties":false,"type":"object","properties":{"___interval":{"default":"45s","description":"Interval to be used for health check. e.g.: 30s to run health check every 30 seconds.","type":"string"},"___timeout":{"default":"5s","description":"Health check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","type":"string"},"___uri":{"default":"","description":"Path to be used for health check. If empty or not specified, tcp based check is used.","type":"string"}}},"_88security":{"additionalProperties":false,"properties":{"___profile":{"default":"default","type":"string","maxLength":100}}},"_88template-args":{"additionalProperties":true,"properties":{"___command":{"oneOf":[{"type":"string","maxLength":4096},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___value":{"type":"string","maxLength":8192},"___encrypted":{"type":"boolean"}},"required":["value"]}}]},"___image":{"type":"string","maxLength":1024},"___docker-args":{"oneOf":[{"type":"string","maxLength":1024},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___value":{"type":"string","maxLength":8192},"___encrypted":{"type":"boolean"}},"required":["value"]}}]},"___environment":{"$eref":{"patternProperties":{"___.*":{"oneOf":[{"type":"string","maxLength":4096},{"$ref":"#\/definitions\/encrypted-type"}]}},"additionalProperties":false}}}},"_88deployment-check":{"additionalProperties":false,"properties":{"___min-nodes":{"description":"Minimum number of nodes for deployment. (Used for deployment check)","type":"number","minimum":1},"___timeout":{"default":"5s","description":"Deployment check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","type":"string"},"___attempts":{"default":"10","description":"Maximum number of attempts for deployment check before marking deployment as failed.","type":"number"},"___port":{"description":"Application internal Port to be used for discover check (Use 0 to disable discover check)","type":"number","minimum":0},"___path":{"default":"","description":"Optional path to be used for performing deployment check. If null, empty or un-specified, only discover check is performed.","type":"string"}}},"_88notifications":{"patternProperties":{"___github":{"$eref":{"additionalProperties":false,"properties":{"___url":{"description":"Github API url base","type":"string"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___token":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/encrypted-type"}],"description":"Github Oauth token"},"___level":{"description":"Min level for the message to activate this notifier","type":"number"}}}},"___hipchat":{"$eref":{"additionalProperties":false,"properties":{"___url":{"description":"Hipchat v2 api url","type":"string"},"___room":{"description":"Room to be used for notification","type":"string"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"description":"Min level for the message to activate this notifier","type":"number"},"___token":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/encrypted-type"}],"description":"Hipchat API v2 token (personal\/ room) for notification"},"___colors":{"description":"Color mapping","type":"object"}}}},"___.*":{"$eref":{"additionalProperties":true,"properties":{"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"description":"Min level for the message to activate this notifier","type":"number"}}}}}},"_88deployment-stop":{"additionalProperties":false,"properties":{"___timeout":{"default":"120s","description":"Deployment stop timeout represented in terms of seconds or minutes. e.g: 30s for timeout of 30 seconds. The application will be sent SIGTERM signal and will have this time for its cleanup.","type":"string"},"___check-retries":{"default":"10","description":"Maximum no. of retries to be attempted to check if deployment is stopped.","type":"number"}}},"_88proxy":{"additionalProperties":false,"type":"object","properties":{"___upstreams":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy Upstream (Backend) definition","additionalProperties":false,"type":"object","properties":{"___health":{"$ref":"#\/definitions\/health"},"___mode":{"default":"http","description":"Proxy mode (http or tcp)","enum":["http","tcp"]},"___ttl":{"default":"1w","description":"Time to live for this upstream during which no registration is received for node discovery.","type":"string"}}}}},"description":"Backends associated with the proxy"},"___hosts":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy Host definition","additionalProperties":false,"type":"object","properties":{"___hostname":{"pattern":"^[a-zA-Z0-9\\-.\\s,]*[a-zA-Z0-9\\s\\-,]$","description":"Hostname(s) to be registered with proxy. If multiple hosts need to be specified, separate them using comma or space","type":"string"},"___enabled":{"description":"Is host enabled?","type":"boolean"},"___locations":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/location"}},"description":"Locations for given proxy host.","type":"object"}}}}},"description":"Hosts associated with the proxy","type":"object"},"___listeners":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy TCP Listener definition","type":"object"}}},"description":"TCP Listeners associated with proxy (for tcp based proxy)"}}},"_88meta-info":{"additionalProperties":true,"properties":{"___git":{"$eref":{"additionalProperties":true,"properties":{"___ref":{"type":"string","maxLength":100},"___commit":{"type":["string","null"],"maxLength":100},"___owner":{"type":"string","maxLength":100},"___repo":{"type":"string","maxLength":100}}}},"___job-id":{"type":"string","maxLength":100},"___deployer":{"type":"object"}}},"_88listener":{"description":"Proxy TCP Listener definition","type":"object"},"_88templates":{"additionalProperties":true,"properties":{"___.*":{"$eref":{"additionalProperties":true,"properties":{"___args":{"$ref":"#\/definitions\/template-args"}}}}}},"_88deployment":{"additionalProperties":false,"properties":{"___name":{"type":"string","maxLength":512},"___version":{"type":"string","maxLength":100},"___type":{"enum":["blue-green","red-green","a\/b","custom"]},"___check":{"$eref":{"additionalProperties":false,"properties":{"___min-nodes":{"description":"Minimum number of nodes for deployment. (Used for deployment check)","type":"number","minimum":1},"___timeout":{"default":"5s","description":"Deployment check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","type":"string"},"___attempts":{"default":"10","description":"Maximum number of attempts for deployment check before marking deployment as failed.","type":"number"},"___port":{"description":"Application internal Port to be used for discover check (Use 0 to disable discover check)","type":"number","minimum":0},"___path":{"default":"","description":"Optional path to be used for performing deployment check. If null, empty or un-specified, only discover check is performed.","type":"string"}}}},"___mode":{"enum":["blue-green","red-green","a\/b","custom"]},"___nodes":{"maximum":12,"type":"number","minimum":1},"___stop":{"$eref":{"additionalProperties":false,"properties":{"___timeout":{"default":"120s","description":"Deployment stop timeout represented in terms of seconds or minutes. e.g: 30s for timeout of 30 seconds. The application will be sent SIGTERM signal and will have this time for its cleanup.","type":"string"},"___check-retries":{"default":"10","description":"Maximum no. of retries to be attempted to check if deployment is stopped.","type":"number"}}},"type":"object"}}},"_88upstream":{"description":"Proxy Upstream (Backend) definition","additionalProperties":false,"type":"object","properties":{"___health":{"$eref":{"description":"Health check definition for proxy upstream","additionalProperties":false,"type":"object","properties":{"___interval":{"default":"45s","description":"Interval to be used for health check. e.g.: 30s to run health check every 30 seconds.","type":"string"},"___timeout":{"default":"5s","description":"Health check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","type":"string"},"___uri":{"default":"","description":"Path to be used for health check. If empty or not specified, tcp based check is used.","type":"string"}}}},"___mode":{"default":"http","description":"Proxy mode (http or tcp)","enum":["http","tcp"]},"___ttl":{"default":"1w","description":"Time to live for this upstream during which no registration is received for node discovery.","type":"string"}}},"_88template":{"additionalProperties":true,"properties":{"___args":{"$eref":{"additionalProperties":true,"properties":{"___command":{"oneOf":[{"type":"string","maxLength":4096},{"$ref":"#\/definitions\/encrypted-type"}]},"___image":{"type":"string","maxLength":1024},"___docker-args":{"oneOf":[{"type":"string","maxLength":1024},{"$ref":"#\/definitions\/encrypted-type"}]},"___environment":{"$ref":"#\/definitions\/environment"}}}}}},"_88notification":{"additionalProperties":true,"properties":{"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"description":"Min level for the message to activate this notifier","type":"number"}}},"_88git":{"additionalProperties":true,"properties":{"___ref":{"type":"string","maxLength":100},"___commit":{"type":["string","null"],"maxLength":100},"___owner":{"type":"string","maxLength":100},"___repo":{"type":"string","maxLength":100}}}},"properties":{"___templates":{"$eref":{"additionalProperties":true,"properties":{"___.*":{"$ref":"#\/definitions\/template"}}}},"___deployment":{"$eref":{"additionalProperties":false,"properties":{"___name":{"type":"string","maxLength":512},"___version":{"type":"string","maxLength":100},"___type":{"enum":["blue-green","red-green","a\/b","custom"]},"___check":{"$ref":"#\/definitions\/deployment-check"},"___mode":{"enum":["blue-green","red-green","a\/b","custom"]},"___nodes":{"maximum":12,"type":"number","minimum":1},"___stop":{"type":"object","$ref":"#\/definitions\/deployment-stop"}}}},"___state":{"enum":["NEW","STARTED","PROMOTED","DECOMMISSIONED","FAILED"]},"___proxy":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___upstreams":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/upstream"}},"description":"Backends associated with the proxy"},"___hosts":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/host"}},"description":"Hosts associated with the proxy","type":"object"},"___listeners":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/listener"}},"description":"TCP Listeners associated with proxy (for tcp based proxy)"}}}},"___security":{"$eref":{"additionalProperties":false,"properties":{"___profile":{"default":"default","type":"string","maxLength":100}}}},"___notifications":{"$eref":{"patternProperties":{"___github":{"$ref":"#\/definitions\/notification-github"},"___hipchat":{"$ref":"#\/definitions\/notification-hipchat"},"___.*":{"$ref":"#\/definitions\/notification"}}}},"___schedule":{"description":"Run this deployment as scheduled job. See: https:\/\/www.freedesktop.org\/software\/systemd\/man\/systemd.time.html#Calendar%20Events","type":"string"},"___meta-info":{"$eref":{"additionalProperties":true,"properties":{"___git":{"$ref":"#\/definitions\/git"},"___job-id":{"type":"string","maxLength":100},"___deployer":{"type":"object"}}}},"___environment":{"$eref":{"patternProperties":{"___.*":{"oneOf":[{"type":"string","maxLength":4096},{"$ref":"#\/definitions\/encrypted-type"}]}},"additionalProperties":false},"description":"Defines top level environment (key, value) support"}},"required":["meta-info"]}