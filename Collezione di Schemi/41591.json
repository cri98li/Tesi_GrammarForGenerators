{"invocation-schema":{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","title":"Invocation manifest for AFQ Pipeline: Automated Fiber Quantification Pipeline (DTIInit + MRtrix3 + ET + LiFE + AFQ)","type":"object","properties":{"___config":{"type":"object","properties":{"___track_maxLengthThreshMm":{"default":250,"type":"integer"},"___track_algorithm":{"default":"mrtrix","type":"string"},"___mrtrix_mrTrixAlgo":{"default":"iFOD2","type":"string"},"___AFQ_Output_Name":{"default":"afq_output","type":"string"},"___track_faThresh":{"default":0.2,"type":"number"},"___AFQ_Browser_Title":{"default":"AFQ_Browser","type":"string"},"___numBootStrapSamples":{"default":500,"type":"integer"},"___track_minLengthThreshMm":{"default":50,"type":"integer"},"___ET_numberFibers":{"default":500000,"type":"number"},"___imresample":{"default":0,"type":"integer"},"___track_angleThresh":{"default":30,"type":"integer"},"___cutoffLower":{"default":10,"type":"integer"},"___fitMethod":{"default":"ls","type":"string"},"___computenorms":{"default":1,"type":"integer"},"___life_test":{"default":false,"type":"boolean"},"___normalization":{"default":"spm","type":"string"},"___ET_angleValues":{"default":"47.2, 23.1, 11.5, 5.7, 2.9","type":"string"},"___dwOutMm_2":{"default":2,"type":"number"},"___maxLen":{"default":4,"type":"integer"},"___dwOutMm_1":{"default":2,"type":"number"},"___life_saveOutput":{"default":true,"type":"boolean"},"___track_seedVoxelOffset_1":{"default":0.25,"type":"number"},"___ET_minlength":{"default":10,"type":"number"},"___life_runLife":{"default":true,"type":"boolean"},"___track_seedVoxelOffset_2":{"default":0.75,"type":"number"},"___rotateBvecsWithRx":{"default":0,"type":"integer"},"___flipLrApFlag":{"default":0,"type":"integer"},"___phaseEncodeDir":{"default":2,"type":"integer"},"___noiseCalcMethod":{"default":"b0","type":"string"},"___ET_runET":{"default":true,"type":"boolean"},"___computeCSD":{"default":1,"type":"integer"},"___maxDist":{"default":5,"type":"integer"},"___dwOutMm_3":{"default":2,"type":"number"},"___life_writePDB":{"default":false,"type":"boolean"},"___cleanFibers":{"default":1,"type":"integer"},"___track_offsetJitter":{"default":0,"type":"number"},"___fiberWeighting":{"default":1,"type":"integer"},"___track_wPuncture":{"default":0.2,"type":"number"},"___numberOfNodes":{"default":100,"type":"integer"},"___life_num_iterations":{"default":100,"type":"number"},"___track_faMaskThresh":{"default":0.3,"type":"number"},"___ET_maxlength":{"default":250,"type":"number"},"___mrtrix_multishell":{"default":false,"type":"boolean"},"___track_stepSizeMm":{"default":1,"type":"integer"},"___mrtrix_tool":{"default":"freesurfer","type":"string"},"___track_nfibers":{"default":500000,"type":"integer"},"___eddyCorrect":{"default":1,"type":"integer"},"___track_whichInterp":{"default":1,"type":"integer"},"___rotateBvecsWithCanXform":{"default":1,"type":"integer"},"___savefigs":{"default":0,"type":"integer"},"___nStep":{"default":50,"type":"integer"},"___life_discretization":{"default":360,"type":"number"},"___cleanIter":{"default":5,"type":"integer"},"___clip2rois":{"default":1,"type":"integer"},"___track_whichAlgorithm":{"default":1,"type":"integer"},"___bsplineInterpFlag":{"default":0,"type":"integer"},"___cutoffUpper":{"default":90,"type":"integer"},"___cleanClippedFibers":{"default":0,"type":"integer"}},"required":["cleanIter","imresample","track_algorithm","computeCSD","fiberWeighting","life_saveOutput","track_minLengthThreshMm","savefigs","rotateBvecsWithRx","AFQ_Browser_Title","life_runLife","bsplineInterpFlag","mrtrix_multishell","track_faThresh","maxDist","track_whichAlgorithm","mrtrix_tool","life_writePDB","clip2rois","phaseEncodeDir","ET_maxlength","track_offsetJitter","track_nfibers","cutoffUpper","cleanClippedFibers","ET_numberFibers","numberOfNodes","track_maxLengthThreshMm","AFQ_Output_Name","numBootStrapSamples","flipLrApFlag","track_faMaskThresh","life_test","eddyCorrect","track_wPuncture","maxLen","computenorms","track_angleThresh","track_seedVoxelOffset_1","ET_angleValues","life_num_iterations","normalization","cutoffLower","ET_minlength","mrtrix_mrTrixAlgo","noiseCalcMethod","rotateBvecsWithCanXform","track_stepSizeMm","nStep","track_whichInterp","cleanFibers","ET_runET","track_seedVoxelOffset_2","life_discretization","fitMethod","dwOutMm_3","dwOutMm_2","dwOutMm_1"]},"___inputs":{"type":"object","properties":{"___bvec":{"type":"object","properties":{"___type":{"enum":["bvec"]}}},"___dwi":{"type":"object","properties":{"___type":{"enum":["nifti"]}}},"___anatomical":{"type":"object","properties":{"___type":{"enum":["nifti"]}}},"___bval":{"type":"object","properties":{"___type":{"enum":["bval"]}}}},"required":["bval","bvec","dwi"]}},"required":["config","inputs"]},"exchange":{"rootfs-hash":"sha384:865c4fb383eecbc88d69041a5a1383313de82cc74965f3542106874ddbd75bc76b573bd62053898e75a194857276ba0d","git-commit":"f515efdb310c65bd2fcb6fe2665da81ca492d4e8","rootfs-url":"https:\/\/storage.googleapis.com\/flywheel-exchange\/scitran-afq-pipeline-sha384-865c4fb383eecbc88d69041a5a1383313de82cc74965f3542106874ddbd75bc76b573bd62053898e75a194857276ba0d.tgz"},"gear":{"author":"Yeatman et al., Stanford VISTA Lab, FMRIB Software Lab, MRTrix, Pestilli et al., Takemura et al.","inputs":{"bval":{"description":"BVAL file","type":{"enum":["bval"]},"base":"file"},"dwi":{"description":"DWI NIfTI file","type":{"enum":["nifti"]},"base":"file"},"anatomical":{"description":"OPTIONAL: Anatomical (e.g., t1-weighted) NIfTI file. During the initial phase of processing the diffusion data (b=0 images) will be aligned to this image. By default the DWI data will be aligned to the MNI_EPI template.","optional":true,"type":{"enum":["nifti"]},"base":"file"},"bvec":{"description":"BVEC file.","type":{"enum":["bvec"]},"base":"file"}},"custom":{"docker-image":"scitran\/afq-pipeline:3.0.0"},"description":"This gear contains a multi-step pipeline designed to run DTIInit, MRtrix3, LiFE, ET, and AFQ. DTIInit runs preprocessing steps, MRTrix3 + Ensemble Tractography + LiFE generate a connectome which is then run through Automated Fiber Quantification (AFQ). AFQ generates tract profiles of tissue properties for major fiber tracts in the brain. This gear also generates AFQ Browser outputs for visualization. Required inputs are (1) DWI NIfTI image, (2) BVEC file, (3) BVAL file, and (4) and Anatomical NIfTI file - which is optional and will be used to align the DWI data, if provided.","source":"https:\/\/github.com\/scitran-apps\/afq-pipline","label":"AFQ Pipeline: Automated Fiber Quantification Pipeline (DTIInit + MRtrix3 + ET + LiFE + AFQ)","version":"3.0.0","url":"https:\/\/github.com\/yeatmanlab\/afq","maintainer":"Michael Perry <lmperry@stanford.edu>","license":"Other","name":"afq-pipeline","flywheel":"0","cite":"Yeatman J.D., Dougherty R.F., Myall N.J., Wandell B.A., Feldman H.M. (2012). Tract Profiles of White Matter Properties: Automating Fiber-Tract Quantification. PLoS One.; M. Jenkinson, C.F. Beckmann, T.E. Behrens, M.W. Woolrich, S.M. Smith. FSL. NeuroImage, 62:782-90, 2012.  Evaluation and statistical inference for human connectomes. F. Pestilli, J.D. Yeatman, A. Rokem, K.N. Kay & B.A. Wandell (2014) Nature Methods doi:10.1038\/nmeth.3098 Published online 07 September 2014. https:\/\/mrtrix.readthedocs.io\/en\/latest\/reference\/references.html.  Takemura H, Caiafa CF, Wandell BA, Pestilli F (2016) Ensemble Tractography. PLoS Comput Biol 12(2): e1004692. https:\/\/doi.org\/10.1371\/journal.pcbi.1004692","config":{"cleanIter":{"default":5,"description":"AFQ: Maximum number of iterations of the cleaning algorithm.","type":"integer"},"cleanClippedFibers":{"default":0,"description":"AFQ: If cleanFibers == 1, then this will indicate whether to perform the cleaning on just the clipped portion of the tract or on the full tract. This may be helpful for tracts like the ILF that are extremely messy with looping fibers etc.","type":"integer"},"flipLrApFlag":{"default":0,"description":"DTIINIT: This flag will signal dtiRawBuildBvecs to reorient the gradient directions specified in the dwepi.grads file to logical space rather than keeping the directions in scanner space. Thus, the bvecs do not need to be reoriented for oblique prescriptions as with some other DTI sequences. However, this sequence assumes that the 2nd column in dwepi.grads is the phase-encode dim. If your phase-encode is the usual '2', then this is fine. But, if you run ASSET and change the phase encode to L-R (dim 1), you need to swap the first and second columns of dwepi.grads. Also, there appears to be a flip in the phase-encode dim, so you also need to flip the sign on the phase-encode column. DEFAULT=0","type":"integer"},"track_minLengthThreshMm":{"default":50,"description":"AFQ: Discard Fibers shorter than this threshold in mm.","type":"integer"},"computenorms":{"default":1,"description":"AFQ: Whether or not to compute control group norms.","type":"integer"},"dwOutMm_1":{"default":2,"description":"DTIINIT: Resolution of the output in mm. DEFAULT=2","type":"number"},"dwOutMm_3":{"default":2,"description":"DTIINIT: Resolution of the output in mm. DEFAULT=2","type":"number"},"dwOutMm_2":{"default":2,"description":"DTIINIT: Resolution of the output in mm. DEFAULT=2","type":"number"},"ET_minlength":{"default":10,"description":"ET: Minimum fiber length (in mm). DEFAULT=10","type":"number"},"savefigs":{"default":0,"description":"AFQ: Save figures of fiber groups. (1=yes, 0=no)","type":"integer"},"normalization":{"default":"spm","description":"AFQ: Which software package to use for normalization. ('spm', 'ants')","type":"string"},"life_runLife":{"default":true,"description":"LiFE: Run LiFE algorithm. DEFAULT=true","type":"boolean"},"life_num_iterations":{"default":100,"description":"LiFE: Number of iterations for LiFE algorithm. DEFAULT=100","type":"number"},"track_offsetJitter":{"default":0,"description":"AFQ: Offset Jitter is the standard deviation of a a random jitter applied to the seeds (in voxel units). E.g., offsetJitter=0.1 will jitter each seedVoxelOffset by a random amount with mean 0 and sigma 0.1. This adds some randomness to each seed point. Each seed point is move randomly by randn*.1mm","type":"number"},"mrtrix_mrTrixAlgo":{"default":"iFOD2","description":"MRTRIX: Tracking algorithm for mrTrix's tckgen. Options are: FACT, iFOD1, iFOD2, NullDits1\/NullDist2, SD_STREAM, SpeedTest, Tensor_Det, Tensor_prob. DEFAULT='iFOD2'","type":"string"},"track_faMaskThresh":{"default":0.3,"description":"AFQ: FA mask threshold from which to initialize tracking.","type":"number"},"fiberWeighting":{"default":1,"description":"AFQ: Set the amount of weighting that will be applied when calculating tract profiles. 0 means that each fiber contributes equally. 1 means that we apply gaussian weighting where each fibers contribution to the measurement at a node is weighted by its gaussian distance from the tract core. Values greater than 1 mean that the core of the tract is weighted more heavily and fibers further from the core are weighted less heavily (faster fall off than a gaussian).  See ComputeTractProperties.","type":"integer"},"track_maxLengthThreshMm":{"default":250,"description":"AFQ: Discard Fibers longer than this threshold in mm.","type":"integer"},"maxLen":{"default":4,"description":"AFQ: Remove fibers that are more than 'maxLen' standard deviations from the mean fiber length. (Default = 4 standard deviations). cleanFibers must be set to 1.","type":"integer"},"rotateBvecsWithCanXform":{"default":1,"description":"DTIINIT: Rotate the b-vectors according to the canonical xForm. 0=false, 1=true. DEFAULT=1","type":"integer"},"track_faThresh":{"default":0.2,"description":"AFQ: Stopping criteria FA<0.2","type":"number"},"track_angleThresh":{"default":30,"description":"AFQ: Stopping criteria angle between steps >30 degrees.","type":"integer"},"track_nfibers":{"default":500000,"description":"AFQ: Number of fibers to track. This parameter is only relevant for mrTrix.","type":"integer"},"cleanFibers":{"default":1,"description":"AFQ: cleanFibers == 1 (default) means that once all the fiber groups have been segmented they will be cleaned such that any fiber that (1) is more than params.maxLen standard deviations above the mean fiber length will be removed and (2) any fiber that is more than params.maxDist standard deviations from the core of the tract will be removed.  this means that fibers groups will be forced to be a compact bundle. (1 = YES, 0 = NO)","type":"integer"},"ET_maxlength":{"default":250,"description":"ET: Maximum fiber length (in mm). DEFAULT=250","type":"number"},"track_algorithm":{"default":"mrtrix","description":"AFQ: Do fiber tracking with 'mrdiffusion' or 'mrtrix' if it is installed and the data is HARDI.","type":"string"},"track_whichAlgorithm":{"default":1,"description":"AFQ: Algorithm type for tractography (0=STT Euler, 1=STT RK4, 2=TEND Euler, 3=TEND RK4). Default is STT. See: Basser PJ, Pajevic S, Pierpaoli C, Duda J, Aldroubi A. 2000. In vivo fiber tractography using DT-MRI data. Magnetic Resonance in Medicine 44(4):625-32.","type":"integer"},"life_saveOutput":{"default":true,"description":"LiFE: Save outputs from LiFE algorithm. DEFAULT=true","type":"boolean"},"track_whichInterp":{"default":1,"description":"AFQ: Interpolation Type (0=NN, 1=linear): After each step we interpolate the tensor at that point. Trilinear interpolation works well.","type":"integer"},"track_wPuncture":{"default":0.2,"description":"AFQ: This coefficient can take on values from 0 to 1, and affects how much the propagation should be encouraged to \u201Cpuncture\u201D through planar tensors oriented normal to its path, versus turning into the plane.","type":"number"},"life_test":{"default":false,"description":"LiFE: Run LiFE in test mode. DEFAULT=False","type":"boolean"},"track_stepSizeMm":{"default":1,"description":"AFQ: Distance between steps in the tractography algorithm.","type":"integer"},"numBootStrapSamples":{"default":500,"description":"DTIINIT: Number of bootstrap iterations. DEFAULT=500","type":"integer"},"ET_runET":{"default":true,"description":"ET: Run Ensemble Tractography. DEFAULT=False","type":"boolean"},"noiseCalcMethod":{"default":"b0","description":"DTIINIT: Noise calculation method for robust tensor fitting. Options are 'corner' or 'b0' (default). There are 2 ways to calculate the noise. The first is based on the standard deviation of the signal in the corner of the image (noiseCalcMethod = 'corner'). This method works well as long as the corner of the image has not been padded with zeros. Currently GE zeros out the pixel intensity outside of the brain. So for new GE data we calculate the noise by taking the standard deviation of the b=0 images (noiseCalcMethod = 'b0') which means that we need a number of b0 acquisitions. If you are using robust tensor fitting you must decide how to calculate the image noise. If the corner of the image is padded with zeros then you should use the 'b0' method which calculates the noise based on the std of the b0 image. DEFAULT='b0'","type":"string"},"phaseEncodeDir":{"default":2,"description":"DTIINIT: Phase encoding direction. (1=L\/R='row', 2=A\/P='col'). This value is read from the raw dti nifti field, you should specify it here if it does not exist. If you collected your DTI data using GE's ASSET, you should provide the phase-encode direction (1=L\/R='row', 2=A\/P='col'). Information about this, as well as the b-value and gradient code, can be found in the DICOM file header. DEFAULT=2","type":"integer"},"bsplineInterpFlag":{"default":0,"description":"DTIINIT: Method used for interpolation during resampling (dtiRawResample). 1=bspline. 0=trilinear. DEFAULT=0","type":"integer"},"cutoffLower":{"default":10,"description":"AFQ: The lower percentile cutoff to be used to determine what is 'abnormal'  The default is cutoff = [10 90] meaning that subjects who fall below the  10th percentile or above the 90th percentile will be considered  'abnormal' and their data will be plotted with respect to the control population.","type":"integer"},"ET_angleValues":{"default":"47.2, 23.1, 11.5, 5.7, 2.9","description":"ET: Angle cutoff values to use during ET tracking (comma-separated list). DEFAULT='47.2, 23.1, 11.5, 5.7, 2.9'","type":"string"},"numberOfNodes":{"default":100,"description":"AFQ: The number of nodes to represent each fiber.","type":"integer"},"mrtrix_multishell":{"default":false,"description":"MRTRIX: Set to true if this is multi-shell input data. DEFAULT=False","type":"boolean"},"fitMethod":{"default":"ls","description":"DTIINIT: Fit-method for tensor fitting. Options are ['ls', 'rt', 'lsrt']: 'ls': least-squares (default) 'rt': RESTORE robust tensor fitting and outlier rejection (Chang, Jones & Pierpaoli (2005) RESTORE: Robust Estimation of Tensors by Outlier Rejection. Magnetic Resonance in Medicine, v53). 'lsrt': does least-squares and robust tensor fitting in one go. DEFAULT='ls'","type":"string"},"computeCSD":{"default":1,"description":"AFQ: Whether or not to compute constrained spherical deconvolution using mrtrix. 0 means don't use mrtrix. 1 means use mrtrix with the default lmax (4). Otherwise you can set the lmax by with a scaler.","type":"integer"},"track_seedVoxelOffset_1":{"default":0.25,"description":"AFQ: seedVoxelOffsets is the relative position of the seed(s) within each seed voxel. E.g., seedVoxelOffsets = [0.5] will put one seed at the center of each voxel, while [0.25 0.75] will place 8 seeds in each voxel. Note that every seed voxel gets at least one seed.","type":"number"},"track_seedVoxelOffset_2":{"default":0.75,"description":"AFQ: seedVoxelOffsets is the relative position of the seed(s) within each seed voxel. E.g., seedVoxelOffsets = [0.5] will put one seed at the center of each voxel, while [0.25 0.75] will place 8 seeds in each voxel. Note that every seed voxel gets at least one seed.","type":"number"},"life_writePDB":{"default":false,"description":"LiFE: Write fibers out in PDB. DEFAULT=False","type":"boolean"},"rotateBvecsWithRx":{"default":0,"description":"DTIINIT: Rotate the b-vectors according to the scanner prescription. 0=false, 1=true. DEFAULT=0","type":"integer"},"ET_numberFibers":{"default":500000,"description":"ET: Number of fibers to generate. DEFAULT=500000","type":"number"},"maxDist":{"default":5,"description":"AFQ: Remove fibers that are more than 'maxDist' standard deviations from the core of the tract. (Default = 5 standard deviations). cleanFibers must be set to 1.","type":"integer"},"mrtrix_tool":{"default":"freesurfer","description":"MRTRIX: The algorithm to be used to complete the script operation; additional details and options become available once an algorithm is nominated. Options are: freesurfer, fsl DEFAULT='freesurfer'","type":"string"},"imresample":{"default":0,"description":"AFQ: For additional images that are passed into AFQ you can set a resolution to resample those images to before computing tract profiles (e.g., [2 2 2])","type":"integer"},"cutoffUpper":{"default":90,"description":"AFQ: The upper percentile cutoff to be used to determine what is 'abnormal'  The default is cutoff = [10 90] meaning that subjects who fall below the  10th percentile or above the 90th percentile will be considered 'abnormal' and their data will be plotted with respect to the control population.","type":"integer"},"AFQ_Output_Name":{"default":"afq_output","description":"AFQ: Output base name for AFQ Results. DEFAULT='afq_output'","type":"string"},"eddyCorrect":{"default":1,"description":"DTIINIT: Motion and eddy-current correction. Options 0, 1, -1. 0=Only motion correction is done. 1=Do eddy-current and motion correction. -1=No motion or eddy correction. DEFAULT=1","type":"integer"},"nStep":{"default":50,"description":"DTIINIT: The number of steps for the restore algorithm in the robust tensor fitting case. (dtiRawFitTensorRobust). DEFAULT=50","type":"integer"},"clip2rois":{"default":1,"description":"AFQ: Should we analyze the whole length of the fiber group or just the central portion spanning between 2 ROIs. (1=YES, 0=NO)","type":"integer"},"AFQ_Browser_Title":{"default":"AFQ_Browser","description":"AFQ: Title for the AFQ-browser web-page. DEFAULT='AFQ_Browser'","type":"string"},"life_discretization":{"default":360,"description":"LiFE: Discretization parameter (this parameter defines the resolution of the Phi tensor in describing the orientation of the fascicles in the connectome (number of orientations encoded in Phi, more specifically the size of Phi in mode 1) DEFAULT=360","type":"number"}}}}