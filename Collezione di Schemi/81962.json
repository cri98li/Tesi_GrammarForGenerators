{"$schema":"http:\/\/json-schema.org\/draft-04\/schema#","id":"#job-config-v1","additionalProperties":false,"title":"Schema for Job Config","type":"object","definitions":{"_88notification-github":{"additionalProperties":true,"properties":{"___url":{"description":"Github API url base","type":"string"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___token":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"$ref":"#\/definitions\/template-type\/properties\/template"},"___value":{"$ref":"#\/definitions\/template-type\/properties\/value"},"___encrypted":{"default":false,"type":"boolean"}},"required":["value"]},"description":"Github Oauth token","type":"object"},"___level":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Min level for the message to activate this notifier"}}},"_88host":{"description":"Proxy Host definition","additionalProperties":false,"type":"object","properties":{"___hostname":{"oneOf":[{"$fref":"${base_url}\/schemas\/job-config-evaluated-v1#\/definitions\/host\/properties\/hostname"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"type":"boolean"},"___value":{"type":"string"}},"required":["value"]}}],"description":"Hostname(s) to be registered with proxy. If multiple hosts need to be specified, separate them using comma or space"},"___enabled":{"$eref":{"oneOf":[{"type":"boolean"},{"$ref":"#\/definitions\/template-type"}]},"description":"Is host enabled?"},"___locations":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy location definition for a given proxy path","additionalProperties":false,"type":"object","properties":{"___denied-acls":{"description":"List of Denied proxy ACLs","type":"array","items":{"type":"string"}},"___force-ssl":{"default":false,"description":"If SSL needs to be forced at the given path","$ref":"#\/definitions\/boolean-or-template-type"},"___allowed-acls":{"description":"List of Allowed proxy ACLs","type":"array","items":{"type":"string"}},"___enabled":{"description":"Is location enabled?","$ref":"#\/definitions\/boolean-or-template-type"},"___port":{"description":"Internal container port for proxy.","$ref":"#\/definitions\/number-or-template-type"},"___path":{"description":"Path to be used for proxy","$ref":"#\/definitions\/string-or-template-type"}}}}},"description":"Locations for given proxy host."}}},"_88hook-list":{"patternProperties":{"___.*":{"$eref":{"enabled":{"oneOf":[{"type":"boolean"},{"$ref":"#\/definitions\/template-type"}]}}}},"type":"object"},"_88health":{"description":"Health check definition for proxy upstream","additionalProperties":false,"type":"object","properties":{"___interval":{"description":"Interval to be used for health check. e.g.: 30s to run health check every 30 seconds.","type":"string"},"___timeout":{"description":"Health check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","type":"string"},"___uri":{"description":"Path to be used for health check. If empty or not specified, tcp based check is used.","type":"string"}}},"_88deployer":{"additionalProperties":false,"type":"object","properties":{"___templates":{"type":"object"},"___deployment":{"$eref":{"additionalProperties":false,"properties":{"___name":{"$ref":"#\/definitions\/string-or-template-type"},"___version":{"$ref":"#\/definitions\/string-or-template-type"},"___type":{"$ref":"#\/definitions\/string-or-template-type"},"___check":{"$ref":"#\/definitions\/deployment-check"},"___nodes":{"$ref":"#\/definitions\/number-or-template-type"},"___stop":{"$ref":"#\/definitions\/deployment-stop"}}},"description":"Deployment configuration."},"___url":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"URL for the deployer"},"___proxy":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___upstreams":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/upstream"}},"description":"Backends associated with the proxy"},"___hosts":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/host"}},"description":"Hosts associated with the proxy"},"___listeners":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/listener"}},"description":"TCP Listeners associated with proxy (for tcp based proxy)"}}}},"___endpoints":{"type":"object"},"___enabled":{"$eref":{"oneOf":[{"type":"boolean"},{"$ref":"#\/definitions\/template-type"}]},"description":"Is deployer enabled?"},"___variables":{"$eref":{"patternProperties":{"___.*":{"oneOf":[{"type":"string"},{"type":"boolean"},{"type":"number"},{"$ref":"#\/definitions\/variable-type"}]}},"type":"object"}}}},"_88template-type":{"additionalProperties":false,"type":"object","properties":{"___template":{"type":"boolean"},"___value":{"type":"string"}},"required":["value"]},"_88boolean-or-template-type":{"oneOf":[{"type":"boolean"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"type":"boolean"},"___value":{"type":"string"}},"required":["value"]}}]},"_88deployment-check":{"additionalProperties":false,"properties":{"___min-nodes":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Minimum number of nodes for deployment. (Used for deployment check)"},"___timeout":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"Deployment check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds"},"___attempts":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Maximum number of attempts for deployment check before marking deployment as failed."},"___port":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Application internal Port to be used for discover check"},"___path":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"Optional path to be used for performing deployment check. If null, empty or un-specified, only discover check is performed."}}},"_88notifications":{"patternProperties":{"___github":{"$eref":{"additionalProperties":true,"properties":{"___url":{"description":"Github API url base","type":"string"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___token":{"description":"Github Oauth token","type":"object","$ref":"#\/definitions\/encrypted-type"},"___level":{"description":"Min level for the message to activate this notifier","$ref":"#\/definitions\/number-or-template-type"}}}},"___hipchat":{"$eref":{"additionalProperties":false,"properties":{"___url":{"description":"Hipchat v2 api url","type":"string"},"___room":{"description":"Room to be used for notification","$ref":"#\/definitions\/string-or-template-type"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"description":"Min level for the message to activate this notifier","$ref":"#\/definitions\/number-or-template-type"},"___token":{"description":"Hipchat API v2 token (personal\/ room) for notification","type":"object","$ref":"#\/definitions\/encrypted-type"},"___colors":{"description":"Color mapping","type":"object"}}}},"___.*":{"$eref":{"additionalProperties":true,"properties":{"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"description":"Min level for the message to activate this notifier","$ref":"#\/definitions\/number-or-template-type"}}}}}},"_88deployment-stop":{"additionalProperties":false,"properties":{"___timeout":{"default":"30s","$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"Deployment stop timeout represented in terms of seconds or minutes. e.g: 30s for timeout of 30 seconds. The application will be sent SIGTERM signal and will have this time for its cleanup."},"___check-retries":{"default":"10","$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Maximum no. of retries to be attempted to check if deployment is stopped."}}},"_88hooks":{"additionalProperties":false,"type":"object","properties":{"___ci":{"$eref":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/hook-type"}},"type":"object"}},"___builder":{"$eref":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/hook-type"}},"type":"object"}},"___scm-create":{"$eref":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/hook-type"}},"type":"object"}},"___scm-push":{"$eref":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/hook-type"}},"type":"object"}}}},"_88number-or-template-type":{"oneOf":[{"type":"number"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"type":"boolean"},"___value":{"type":"string"}},"required":["value"]}}]},"_88upstream":{"description":"Proxy Upstream (Backend) definition","additionalProperties":false,"type":"object","properties":{"___health":{"$eref":{"description":"Health check definition for proxy upstream","additionalProperties":false,"type":"object","properties":{"___interval":{"description":"Interval to be used for health check. e.g.: 30s to run health check every 30 seconds.","type":"string"},"___timeout":{"description":"Health check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","type":"string"},"___uri":{"description":"Path to be used for health check. If empty or not specified, tcp based check is used.","type":"string"}}}},"___mode":{"default":"http","description":"Proxy mode (http or tcp)","enum":["http","tcp"]}}},"_88notification":{"additionalProperties":true,"properties":{"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Min level for the message to activate this notifier"}}},"_88environment":{"patternProperties":{"___.*":{"oneOf":[{"type":"string","maxLength":4096},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"$ref":"#\/definitions\/template-type\/properties\/template"},"___value":{"$ref":"#\/definitions\/template-type\/properties\/value"},"___encrypted":{"default":false,"type":"boolean"}},"required":["value"]}}]}},"additionalProperties":false,"type":"object"},"_88notification-hipchat":{"additionalProperties":false,"properties":{"___url":{"description":"Hipchat v2 api url","type":"string"},"___room":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"Room to be used for notification"},"___enabled":{"description":"Used for enabling\/disabling notification","type":"boolean"},"___level":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Min level for the message to activate this notifier"},"___token":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"$ref":"#\/definitions\/template-type\/properties\/template"},"___value":{"$ref":"#\/definitions\/template-type\/properties\/value"},"___encrypted":{"default":false,"type":"boolean"}},"required":["value"]},"description":"Hipchat API v2 token (personal\/ room) for notification","type":"object"},"___colors":{"description":"Color mapping","type":"object"}}},"_88encrypted-type":{"additionalProperties":false,"type":"object","properties":{"___template":{"$eref":{"type":"boolean"}},"___value":{"$eref":{"type":"string"}},"___encrypted":{"default":false,"type":"boolean"}},"required":["value"]},"_88variables":{"patternProperties":{"___.*":{"oneOf":[{"type":"string"},{"type":"boolean"},{"type":"number"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"$ref":"#\/definitions\/template-type\/properties\/template"},"___value":{"$ref":"#\/definitions\/template-type\/properties\/value"},"___priority":{"default":0,"description":"Order in which variable is evaluated.","type":"number"}},"required":["value"]}}]}},"type":"object"},"_88location":{"description":"Proxy location definition for a given proxy path","additionalProperties":false,"type":"object","properties":{"___denied-acls":{"description":"List of Denied proxy ACLs","type":"array","items":{"type":"string"}},"___force-ssl":{"default":false,"$eref":{"oneOf":[{"type":"boolean"},{"$ref":"#\/definitions\/template-type"}]},"description":"If SSL needs to be forced at the given path"},"___allowed-acls":{"description":"List of Allowed proxy ACLs","type":"array","items":{"type":"string"}},"___enabled":{"$eref":{"oneOf":[{"type":"boolean"},{"$ref":"#\/definitions\/template-type"}]},"description":"Is location enabled?"},"___port":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]},"description":"Internal container port for proxy."},"___path":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"Path to be used for proxy"}}},"_88security":{"type":"object","properties":{"___profile":{"type":"string"}}},"_88string-or-template-type":{"oneOf":[{"type":"string"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"type":"boolean"},"___value":{"type":"string"}},"required":["value"]}}]},"_88hook-type":{"enabled":{"oneOf":[{"type":"boolean"},{"$eref":{"additionalProperties":false,"type":"object","properties":{"___template":{"type":"boolean"},"___value":{"type":"string"}},"required":["value"]}}]}},"_88variable-type":{"additionalProperties":false,"type":"object","properties":{"___template":{"$eref":{"type":"boolean"}},"___value":{"$eref":{"type":"string"}},"___priority":{"default":0,"description":"Order in which variable is evaluated.","type":"number"}},"required":["value"]},"_88proxy":{"additionalProperties":false,"type":"object","properties":{"___upstreams":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy Upstream (Backend) definition","additionalProperties":false,"type":"object","properties":{"___health":{"$ref":"#\/definitions\/health"},"___mode":{"default":"http","description":"Proxy mode (http or tcp)","enum":["http","tcp"]}}}}},"description":"Backends associated with the proxy"},"___hosts":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy Host definition","additionalProperties":false,"type":"object","properties":{"___hostname":{"oneOf":[{"$ref":"${base_url}\/schemas\/job-config-evaluated-v1#\/definitions\/host\/properties\/hostname"},{"$ref":"#\/definitions\/template-type"}],"description":"Hostname(s) to be registered with proxy. If multiple hosts need to be specified, separate them using comma or space"},"___enabled":{"description":"Is host enabled?","$ref":"#\/definitions\/boolean-or-template-type"},"___locations":{"patternProperties":{"___.*":{"$ref":"#\/definitions\/location"}},"description":"Locations for given proxy host."}}}}},"description":"Hosts associated with the proxy"},"___listeners":{"patternProperties":{"___.*":{"$eref":{"description":"Proxy TCP Listener definition","type":"object"}}},"description":"TCP Listeners associated with proxy (for tcp based proxy)"}}},"_88listener":{"description":"Proxy TCP Listener definition","type":"object"},"_88deployment":{"additionalProperties":false,"properties":{"___name":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]}},"___version":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]}},"___type":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]}},"___check":{"$eref":{"additionalProperties":false,"properties":{"___min-nodes":{"description":"Minimum number of nodes for deployment. (Used for deployment check)","$ref":"#\/definitions\/number-or-template-type"},"___timeout":{"description":"Deployment check timeout represented in terms of seconds or minutes. e.g: 20s for timeout of 20 seconds","$ref":"#\/definitions\/string-or-template-type"},"___attempts":{"description":"Maximum number of attempts for deployment check before marking deployment as failed.","$ref":"#\/definitions\/number-or-template-type"},"___port":{"description":"Application internal Port to be used for discover check","$ref":"#\/definitions\/number-or-template-type"},"___path":{"description":"Optional path to be used for performing deployment check. If null, empty or un-specified, only discover check is performed.","$ref":"#\/definitions\/string-or-template-type"}}}},"___nodes":{"$eref":{"oneOf":[{"type":"number"},{"$ref":"#\/definitions\/template-type"}]}},"___stop":{"$eref":{"additionalProperties":false,"properties":{"___timeout":{"default":"30s","description":"Deployment stop timeout represented in terms of seconds or minutes. e.g: 30s for timeout of 30 seconds. The application will be sent SIGTERM signal and will have this time for its cleanup.","$ref":"#\/definitions\/string-or-template-type"},"___check-retries":{"default":"10","description":"Maximum no. of retries to be attempted to check if deployment is stopped.","$ref":"#\/definitions\/number-or-template-type"}}}}}}},"properties":{"___deployers":{"patternProperties":{"___.*":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___templates":{"type":"object"},"___deployment":{"description":"Deployment configuration.","$ref":"#\/definitions\/deployment"},"___url":{"description":"URL for the deployer","$ref":"#\/definitions\/string-or-template-type"},"___proxy":{"$ref":"#\/definitions\/proxy"},"___endpoints":{"type":"object"},"___enabled":{"description":"Is deployer enabled?","$ref":"#\/definitions\/boolean-or-template-type"},"___variables":{"$ref":"#\/definitions\/variables"}}}}}},"___enabled":{"$eref":{"oneOf":[{"type":"boolean"},{"$ref":"#\/definitions\/template-type"}]}},"___hooks":{"$eref":{"additionalProperties":false,"type":"object","properties":{"___ci":{"$ref":"#\/definitions\/hook-list"},"___builder":{"$ref":"#\/definitions\/hook-list"},"___scm-create":{"$ref":"#\/definitions\/hook-list"},"___scm-push":{"$ref":"#\/definitions\/hook-list"}}}},"___variables":{"$eref":{"patternProperties":{"___.*":{"oneOf":[{"type":"string"},{"type":"boolean"},{"type":"number"},{"$ref":"#\/definitions\/variable-type"}]}},"type":"object"}},"___security":{"$eref":{"type":"object","properties":{"___profile":{"type":"string"}}},"type":"object"},"___scm":{"type":"object"},"___defaults":{"description":"Defaults for YAML substitution","type":"object"},"___notifications":{"$eref":{"patternProperties":{"___github":{"$ref":"#\/definitions\/notification-github"},"___hipchat":{"$ref":"#\/definitions\/notification-hipchat"},"___.*":{"$ref":"#\/definitions\/notification"}}}},"___schedule":{"$eref":{"oneOf":[{"type":"string"},{"$ref":"#\/definitions\/template-type"}]},"description":"Run this deployment as scheduled job. See: https:\/\/www.freedesktop.org\/software\/systemd\/man\/systemd.time.html#Calendar%20Events"},"___environment":{"$eref":{"patternProperties":{"___.*":{"oneOf":[{"type":"string","maxLength":4096},{"$ref":"#\/definitions\/encrypted-type"}]}},"additionalProperties":false,"type":"object"},"description":"Defines top level environment (key, value) support","type":"object"}},"required":["enabled"]}